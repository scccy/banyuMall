# 任务：第三方业务 - 阿里云OSS文件存储服务开发

**状态**: 规划中  
**创建时间**: 2025-08-01 12:00  
**负责人**: AI Assistant  

## 任务目标

基于阿里云OSS文档，开发一个文件存储Feign客户端微服务，为其他微服务（如core-publisher）提供文件上传功能，记录存储行为和文件哈希值，实现文件去重。

## 参考文档

- [阿里云OSS集成概览](https://help.aliyun.com/zh/oss/developer-reference/integration-overview?spm=a2c4g.11186623.help-menu-31815.d_18_0.6fac1134fIRZmD)
- 项目现有模块结构参考

## 执行步骤

### 第一阶段：模块结构创建
- [ ] 步骤 1: 创建third-party父模块结构
- [ ] 步骤 2: 创建aliyun-oss子模块
- [ ] 步骤 3: 配置Maven依赖关系
- [ ] 步骤 4: 更新项目根目录结构

### 第二阶段：数据库设计
- [ ] 步骤 5: 创建数据库脚本
- [ ] 步骤 6: 创建实体类
- [ ] 步骤 7: 创建Mapper接口

### 第三阶段：业务逻辑实现
- [ ] 步骤 8: 创建DTO类
- [ ] 步骤 9: 实现Service接口和实现类
- [ ] 步骤 10: 实现Controller控制器

### 第四阶段：配置和启动
- [ ] 步骤 11: 创建配置文件
- [ ] 步骤 12: 创建启动类
- [ ] 步骤 13: 创建配置类

### 第五阶段：文档和测试
- [ ] 步骤 14: 更新项目README
- [ ] 步骤 15: 创建模块README
- [ ] 步骤 16: 创建API测试文档

## 技术要点

### 阿里云OSS集成
- 使用阿里云OSS SDK 3.17.4
- 支持文件上传、下载、删除等基本操作
- 支持图片处理（压缩、水印、格式转换）
- 支持访问权限控制和防盗链

### 数据库设计
- 文件信息表：存储文件元数据
- 文件分类表：支持文件分类管理
- 访问日志表：记录文件访问情况

### 功能特性
- 文件上传到OSS并返回访问地址
- 支持指定文件路径，按服务/业务类型/日期组织
- 记录文件存储行为和来源信息
- 提供Feign客户端供其他服务调用
- 文件访问日志记录

### 安全设计
- 文件访问权限控制
- 防盗链配置
- 文件类型限制
- 文件大小限制

### 性能优化
- Redis缓存策略
- 异步处理
- 批量操作支持

## 模块结构

```
third-party/                    # 二级模块 - 第三方业务模块
├── aliyun-oss/               # 三级微服务 - 阿里云OSS服务
│   ├── controller/           # 控制器层
│   ├── service/             # 业务逻辑层
│   ├── mapper/              # 数据访问层
│   ├── entity/              # 实体类
│   ├── dto/                 # 数据传输对象
│   ├── config/              # 配置类
│   ├── util/                # 工具类
│   └── exception/           # 异常处理
└── wechat-work/              # 三级微服务 - 企业微信服务 (预留)
```

## 配置要求

### 阿里云OSS配置
- OSS Endpoint
- Access Key ID
- Access Key Secret
- Bucket名称
- 文件上传限制
- 图片处理配置

### 数据库配置
- MySQL连接配置
- Redis缓存配置
- MyBatis-Plus配置

### 服务配置
- 服务端口：8085
- 服务名称：aliyun-oss
- Nacos注册配置

## 预期成果

1. 完整的文件存储微服务
2. 标准化的文件操作API
3. 完善的文档和测试用例
4. 可扩展的第三方业务模块架构

## 修正记录

**[📋 设计文档优化]** 根据用户反馈，优化了设计文档结构：
- 删除了设计文档中的具体SQL创建语句
- 保留了业务功能说明和表结构描述
- SQL语句统一放在数据库脚本文件中
- 设计文档专注于业务逻辑和架构设计

**[🎯 核心需求重新定义]** 根据用户反馈，重新定义了模块的核心需求：
- 核心功能：提供Feign客户端，让其他微服务上传文件到OSS
- 简化设计：只保留文件存储记录和访问日志两个表
- 路径管理：支持指定文件路径，按服务/业务类型/日期组织
- 业务场景：如core-publisher创建任务时上传图片
- 返回结果：OSS访问地址，供其他服务使用

**[🔧 设计优化调整]** 根据用户反馈，进一步优化设计：
- 移除MD5哈希值去重功能（OSS云端服务自动优化）
- 添加文件路径字段，支持指定上传路径
- 简化API接口，移除文件去重检查接口
- 优化文件组织结构，避免全部上传到根目录

## 风险评估

- 阿里云OSS SDK版本兼容性
- 文件上传性能优化
- 安全配置的完整性
- 错误处理和异常恢复

## 后续扩展

- 支持其他云存储服务（腾讯云COS、AWS S3等）
- 文件处理服务（图片处理、文档转换等）
- 文件分享和协作功能
- CDN集成和加速 