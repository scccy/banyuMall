# ä¸šåŠ¡é€»è¾‘æ±‡æ€»æ–‡æ¡£

**åˆ›å»ºæ—¶é—´**: 2025-07-30  
**æœ€åæ›´æ–°**: 2025-07-31  
**ç‰ˆæœ¬**: 1.1  

## ğŸ“‹ **ç›®å½•**
- [å“åº”æ•°æ®ç»“æ„](#å“åº”æ•°æ®ç»“æ„)
- [é“¾è·¯è¿½è¸ªæœºåˆ¶](#é“¾è·¯è¿½è¸ªæœºåˆ¶)
- [APIå“åº”è§„èŒƒ](#apiå“åº”è§„èŒƒ)

---

## å“åº”æ•°æ®ç»“æ„

### é‡æ„åçš„å“åº”ç±»ç»“æ„
åŸºäºå•ä¸€èŒè´£åŸåˆ™ï¼Œå°†åŸæœ‰çš„ResultDataç±»æ‹†åˆ†ä¸ºä¸‰ä¸ªç‹¬ç«‹çš„ç±»ï¼š

#### 1. ResultData - æ ¸å¿ƒå“åº”æ•°æ®ç»“æ„
**ä½ç½®**: `service/service-common/src/main/java/com/origin/common/ResultData.java`
**èŒè´£**: æ ¸å¿ƒå“åº”æ•°æ®ç»“æ„ç®¡ç†
**å†…å®¹**:
- å“åº”ç ã€å“åº”æ¶ˆæ¯ã€å“åº”æ•°æ®
- å“åº”æ—¶é—´æˆ³
- æˆåŠŸ/å¤±è´¥å“åº”æ–¹æ³•
- å·¥å…·æ–¹æ³•ï¼ˆisSuccessã€getDataç­‰ï¼‰

#### 2. RequestTrace - è¯·æ±‚è¿½è¸ªç±»
**ä½ç½®**: `service/service-common/src/main/java/com/origin/common/RequestTrace.java`
**èŒè´£**: é“¾è·¯è¿½è¸ªå’Œè¯·æ±‚ä¸Šä¸‹æ–‡ç®¡ç†
**å†…å®¹**:
- è¯·æ±‚IDã€ç”¨æˆ·IDã€å®¢æˆ·ç«¯IPã€ç”¨æˆ·ä»£ç†
- è¯·æ±‚/å“åº”æ—¶é—´æˆ³
- æœåŠ¡åç§°ã€è¯·æ±‚è·¯å¾„ã€è¯·æ±‚æ–¹æ³•
- å¤„ç†è€—æ—¶è®¡ç®—
- è¿½è¸ªçŠ¶æ€ç®¡ç†

#### 3. ApiResponse - APIå“åº”åŒ…è£…ç±»
**ä½ç½®**: `service/service-common/src/main/java/com/origin/common/ApiResponse.java`
**èŒè´£**: ç»„åˆå“åº”æ•°æ®å’Œè¯·æ±‚è¿½è¸ªä¿¡æ¯
**å†…å®¹**:
- ç»„åˆResultDataå’ŒRequestTrace
- æä¾›ç»Ÿä¸€çš„APIå“åº”æ¥å£
- å…¼å®¹æ€§æ–¹æ³•ï¼ˆokã€successã€failï¼‰
- ä¾¿æ·çš„è¿½è¸ªä¿¡æ¯è®¾ç½®æ–¹æ³•

### ä½¿ç”¨ç¤ºä¾‹

#### ç®€å•å“åº”ï¼ˆä¸éœ€è¦è¿½è¸ªï¼‰
```java
// ä½¿ç”¨ResultData
return ResultData.success(data);

// ä½¿ç”¨ApiResponse
return ApiResponse.success(data);
```

#### éœ€è¦è¿½è¸ªçš„å“åº”
```java
// åˆ›å»ºè¿½è¸ªä¿¡æ¯
RequestTrace trace = RequestTrace.create("req-123", userId, clientIp, userAgent)
    .setRequestInfo("service-auth", "/api/login", "POST", "{}");

// ä½¿ç”¨ApiResponse
return ApiResponse.successWithTrace("ç™»å½•æˆåŠŸ", userInfo, trace);
```

#### åœ¨æ‹¦æˆªå™¨ä¸­å®Œæˆè¿½è¸ª
```java
// åœ¨å“åº”æ‹¦æˆªå™¨ä¸­
apiResponse.completeTrace(responseStatus);
```

---

## é“¾è·¯è¿½è¸ªæœºåˆ¶

### è¿½è¸ªä¿¡æ¯ç®¡ç†
- **è¯·æ±‚ID**: ç”¨äºé“¾è·¯è¿½è¸ªçš„å”¯ä¸€æ ‡è¯†
- **ç”¨æˆ·ä¿¡æ¯**: ç”¨æˆ·IDã€å®¢æˆ·ç«¯IPã€ç”¨æˆ·ä»£ç†
- **è¯·æ±‚ä¿¡æ¯**: æœåŠ¡åç§°ã€è¯·æ±‚è·¯å¾„ã€è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚å‚æ•°
- **æ—¶é—´ä¿¡æ¯**: è¯·æ±‚æ—¶é—´æˆ³ã€å“åº”æ—¶é—´æˆ³ã€å¤„ç†è€—æ—¶

### è¿½è¸ªçŠ¶æ€ç®¡ç†
- **åˆ›å»ºé˜¶æ®µ**: è®°å½•è¯·æ±‚å¼€å§‹æ—¶é—´å’ŒåŸºæœ¬ä¿¡æ¯
- **å¤„ç†é˜¶æ®µ**: è®°å½•è¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­çš„å…³é”®ä¿¡æ¯
- **å®Œæˆé˜¶æ®µ**: è®°å½•å“åº”çŠ¶æ€å’Œå¤„ç†è€—æ—¶

---

## APIå“åº”è§„èŒƒ

### å“åº”æ ¼å¼
```json
{
  "result": {
    "code": 200,
    "message": "SUCCESS",
    "data": {},
    "timestamp": 1640995200000
  },
  "trace": {
    "requestId": "req-123",
    "userId": 1001,
    "clientIp": "192.168.1.1",
    "userAgent": "Mozilla/5.0...",
    "requestTimestamp": 1640995200000,
    "responseTimestamp": 1640995201000,
    "duration": 1000,
    "serviceName": "service-auth",
    "requestPath": "/api/login",
    "requestMethod": "POST",
    "responseStatus": 200
  }
}
```

### å“åº”ç è§„èŒƒ
- **200**: æˆåŠŸ
- **400**: å®¢æˆ·ç«¯é”™è¯¯
- **401**: æœªæˆæƒ
- **403**: ç¦æ­¢è®¿é—®
- **500**: æœåŠ¡å™¨é”™è¯¯

---

## ğŸ“… **æ›´æ–°å†å²**
- **2025-07-30**: åˆå§‹åˆ›å»ºä¸šåŠ¡é€»è¾‘æ±‡æ€»æ–‡æ¡£
- **2025-07-31**: æ›´æ–°å“åº”æ•°æ®ç»“æ„ï¼Œè®°å½•ResultDataé‡æ„ 