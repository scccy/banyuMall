# 开发规则汇总

## 📋 规则概述

**ID**: RULES-SUMMARY-001  
**Name**: 开发规则汇总  
**Status**: Active  
**创建时间**: 2025-08-04  

## 🏷️ 规则命名逻辑

### 1.1 按功能分类（主要分类）
- **架构设计类 (ARCH-*)**: 系统架构、模块设计、技术选型
- **开发规范类 (DEV-*)**: 代码开发、测试、文档编写
- **配置管理类 (CONFIG-*)**: 配置分离、环境管理
- **依赖管理类 (DEP-*)**: 依赖版本、包管理
- **性能优化类 (PERF-*)**: 性能调优、启动优化
- **安全规范类 (SEC-*)**: 安全配置、权限管理
- **运维规范类 (OPS-*)**: 部署、监控、日志

### 1.2 按模块分类（次要分类）
- **数据库类 (DB-*)**: 数据库设计、查询优化
- **API设计类 (API-*)**: 接口设计、路由规范
- **异常处理类 (EXCEPTION-*)**: 异常处理、错误码管理
- **前端规范类 (FE-*)**: 前端开发、UI/UX
- **移动端类 (MOBILE-*)**: 移动应用开发
- **第三方集成类 (INTEGRATION-*)**: 第三方服务集成

### 1.3 规则ID格式
```
[功能分类]-[序号]_[简短描述]
例如：
- ARCH-001_MODULE_DESIGN
- DEV-001_CODE_STANDARD
- DB-001_PRIMARY_KEY
- EXCEPTION-001_ERROR_HANDLING
- PERF-001_SPRING_BOOT_STARTUP
```

## 🎯 核心规则分类

### 1. 数据库开发规则 (DB-001_PRIMARY_KEY)
**文件**: `.docs/RULES/DB-RULES.md`

#### 关键规则
- **主键命名**: 必须使用 `表名_id` 格式
- **主键类型**: 统一使用 `VARCHAR(32)` 类型
- **关联逻辑**: 左表存在右表ID，避免外键约束
- **索引命名**: `idx_` 前缀普通索引，`uk_` 前缀唯一索引

#### 禁止事项
- 禁止使用外键约束、触发器、存储过程、视图
- 禁止使用VARCHAR存储枚举（使用INT类型）

### 2. 微服务架构设计规则 (ARCH-001_MICROSERVICE_ARCHITECTURE)
**文件**: `.docs/RULES/ARCH-001_MICROSERVICE_ARCHITECTURE.md`

#### 架构分层原则
- **服务层 (service/)**: 基础服务和业务服务
- **核心层 (core/)**: 核心业务模块
- **第三方层 (third-party/)**: 第三方服务集成
- **基础设施层 (zinfra/)**: 数据库、配置、文档

#### 服务拆分原则
- **单一职责**: 每个服务只负责一个业务领域
- **高内聚**: 相关功能聚合在同一服务
- **低耦合**: 服务间通过标准接口通信
- **可独立部署**: 每个服务可独立开发、测试、部署

#### 依赖管理原则
- **单向依赖**: 避免循环依赖
- **分层依赖**: 上层依赖下层，同层不依赖
- **最小依赖**: 只依赖必要的模块

### 3. 模块开发规则 (ARCH-002_MODULE_DESIGN)
**来源**: 项目记忆和经验

#### 配置管理
- **配置类**: 必须在 `service-base` 模块，自动加载生效
- **工具类**: 必须在 `service-common` 模块，供其他模块共享
- **依赖关系**: 配置类优先加载，工具类按需依赖

#### 文档组织
- **模块文档**: 在 `zinfra/moudleDocs/` 下按模块创建文件夹
- **设计文档**: 每个模块包含设计文档和接口测试文档
- **Feign使用**: 文档中需注明是否使用Feign

### 4. API开发规则 (API-001_ROUTE_DESIGN)
**来源**: 项目记忆和经验

#### 路由规范
- **路由命名**: 使用 `/service/<entity>` 格式
- **避免格式**: 不使用 `/service-user/<entity>` 格式

#### 响应规范
- **成功响应**: 使用 `success()` 方法（已修正）
- **统一格式**: 所有API响应格式保持一致

#### 技术选择
- **JSON处理**: 使用 FastJSON2 而非 Jackson

#### Feign客户端规范
- **公共类管理**: Feign客户端使用的公共DTO类必须放在 `service-common` 模块中
- **避免重复**: 禁止在多个模块中重复定义相同的DTO类
- **统一路径**: 所有模块使用 `com.origin.common.dto.*` 路径导入公共DTO类
- **版本一致**: 确保所有模块使用相同版本的公共DTO类
- **序列化**: 优先使用 FastJSON2 进行JSON序列化

### 5. 异常处理规则 (EXCEPTION-001_ERROR_HANDLING)
**文件**: `.docs/RULES/EXCEPTION-001_ERROR_HANDLING.md`

#### 核心原则
- **统一异常处理**: 使用 `@ControllerAdvice` 统一处理异常
- **统一响应格式**: 所有异常都返回 `ResultData` 格式
- **错误码规范**: 使用 `ErrorCode` 枚举定义错误码
- **日志记录**: 异常必须记录详细日志

#### 异常分类
- **业务异常**: 使用 `BusinessException` 处理业务逻辑异常
- **系统异常**: 使用 `GlobalExceptionHandler` 处理系统异常
- **参数异常**: 使用 `@Valid` 和 `@Validated` 进行参数验证
- **权限异常**: 使用专门的权限异常类

#### 错误码分配
- **HTTP状态码**: 200-599，标准HTTP状态码
- **用户相关**: 1000-1999，用户管理相关错误
- **认证相关**: 1100-1199，认证授权相关错误
- **核心服务**: 2000-3999，核心业务服务错误
- **第三方服务**: 4000-4999，第三方服务错误
- **网关相关**: 5000-5999，网关服务相关错误
- **数据库相关**: 7000-7999，数据库操作相关错误
- **缓存相关**: 8000-8999，缓存操作相关错误
- **消息队列**: 9000-9999，消息队列相关错误

#### 禁止事项
- **吞掉异常**: 不允许捕获异常后不处理或记录
- **暴露敏感信息**: 不允许在错误信息中暴露系统内部信息
- **硬编码错误信息**: 不允许硬编码错误信息，必须使用错误码
- **忽略异常**: 不允许忽略重要的异常信息

### 5. 项目规范 (DEV-001_CODE_STANDARD)
**来源**: 项目记忆和用户偏好

#### 开发环境
- **代码作者**: scccy
- **语言偏好**: 使用中文回答和文档
- **IDE使用**: 用户使用 IntelliJ IDEA，不自动启动服务
- **启动方式**: 不使用 start-dev.sh 脚本

#### 工具使用
- **Lombok**: 在DTO类中使用 `@Data` 注解自动生成getter/setter
- **测试**: 不执行Java和Maven测试
- **文档**: 任务完成后更新README项目结构

### 6. MyBatis-Plus分页查询规范 (DEV-002_MYBATIS_PLUS_PAGINATION)
**文件**: `.docs/RULES/DEV-002_MYBATIS_PLUS_PAGINATION.md`

#### 分页插件配置
- **必须 (MUST)** 配置MyBatis-Plus分页插件
- **必须 (MUST)** 使用 `IPage<T>` 接口进行分页查询
- **必须 (MUST)** 使用 `Page<T>` 类创建分页对象

#### 分页查询规范
- **必须 (MUST)** 在Service层进行分页逻辑处理
- **必须 (MUST)** 在Controller层接收分页参数
- **必须 (MUST)** 返回统一的分页响应格式
- **禁止 (MUST NOT)** 在Mapper层直接处理分页逻辑

#### 性能优化
- **必须 (MUST)** 合理设置分页大小，避免大数据量查询
- **必须 (MUST)** 使用索引优化分页查询性能
- **建议 (SHOULD)** 使用缓存减少重复查询

### 7. MyBatis-Plus BOM管理规范 (DEP-001_MYBATIS_PLUS_BOM)
**文件**: `.docs/RULES/DEP-001_MYBATIS_PLUS_BOM.md`
**参考**: [MyBatis-Plus官方安装文档](https://baomidou.com/getting-started/install/)

#### 依赖管理
- **必须 (MUST)** 使用 `mybatis-plus-bom` 管理MyBatis-Plus相关依赖版本
- **必须 (MUST)** 避免版本冲突，统一管理依赖版本
- **禁止 (MUST NOT)** 直接引入MyBatis相关依赖，避免版本差异问题

#### 版本选择
- **Spring Boot 2.x**: 使用 `mybatis-plus-boot-starter`
- **Spring Boot 3.x**: 使用 `mybatis-plus-spring-boot3-starter`
- **JDK 8**: 使用 `mybatis-plus-jsqlparser-4.9`
- **JDK 11+**: 使用 `mybatis-plus-jsqlparser`

### 8. 配置文件分离规则 (CONFIG-001_ENVIRONMENT_SEPARATION)
**文件**: `.docs/RULES/CONFIG-001_ENVIRONMENT_SEPARATION.md`

#### 配置分离原则
- **本地配置**: 基础配置和Nacos连接信息
- **远程配置**: 业务配置和敏感信息
- **环境变量**: 覆盖敏感配置和动态配置
- **分层管理**: 按环境、模块、功能分层管理

#### 配置文件组织
- **application.yml**: 基础配置和Nacos连接
- **service-xxx.yaml**: 业务配置和敏感信息
- **README.md**: 配置说明文档

#### 环境配置规范
- **开发环境**: 详细日志、调试功能、宽松配置
- **测试环境**: 平衡性能、基本监控、测试配置
- **生产环境**: 高性能、安全配置、最小日志

### 9. 性能优化规则 (PERF-001_SPRING_BOOT_STARTUP)
**来源**: 系统规则

#### Spring Boot启动性能优化
- **BeanPostProcessor优化**: 检查并优化加载顺序
- **自动配置优化**: 排除不需要的自动配置
- **网络配置优化**: 简化网络接口检测
- **开发环境优化**: 禁用不必要的安全功能

#### 性能基准
- **开发环境启动时间**: 目标 < 3秒
- **生产环境启动时间**: 目标 < 10秒
- **BeanPostProcessor警告**: 目标 0个

## 🔄 规则优先级

### 高优先级 (必须遵守)
1. **数据库主键命名规范 (DB-001)** - 影响数据一致性
2. **微服务架构设计 (ARCH-001)** - 影响整体架构
3. **模块配置管理 (ARCH-002)** - 影响系统启动和依赖
4. **配置文件分离 (CONFIG-001)** - 影响配置管理
5. **API路由命名 (API-001)** - 影响接口规范
6. **JSON处理选择 (DEV-001)** - 影响序列化性能
7. **MyBatis-Plus分页查询 (DEV-002)** - 影响查询性能和代码规范
8. **MyBatis-Plus BOM管理 (DEP-001)** - 影响依赖版本管理

### 中优先级 (建议遵守)
1. **文档组织规范 (ARCH-002)** - 影响项目维护
2. **代码风格规范 (DEV-001)** - 影响代码可读性
3. **性能优化规则 (PERF-001)** - 影响系统性能

### 低优先级 (可选遵守)
1. **工具使用偏好 (DEV-001)** - 个人开发习惯
2. **环境配置偏好 (CONFIG-001)** - 开发环境设置

## 📝 规则更新流程

### 新增规则
1. **触发条件**: 遇到新问题或优化机会
2. **规则起草**: 创建 `.docs/RULES/[分类]-[序号]_[描述].md` 文件
3. **规则验证**: 在任务中验证规则有效性
4. **规则整合**: 更新本汇总文档

### 规则文件命名示例
```
.docs/RULES/
├── DB-001_PRIMARY_KEY.md          # 数据库主键规范
├── ARCH-001_MICROSERVICE_ARCHITECTURE.md # 微服务架构设计规则
├── ARCH-002_MODULE_DESIGN.md      # 模块设计规范
├── CONFIG-001_ENVIRONMENT_SEPARATION.md # 配置文件分离规则
├── API-001_ROUTE_DESIGN.md        # API路由规范
├── DEV-001_CODE_STANDARD.md       # 代码开发规范
├── DEV-002_MYBATIS_PLUS_PAGINATION.md # MyBatis-Plus分页查询规则
├── DEP-001_MYBATIS_PLUS_BOM.md    # MyBatis-Plus BOM管理规则
├── PERF-001_SPRING_BOOT_STARTUP.md # 性能优化规则
├── SEC-001_AUTHENTICATION.md      # 安全认证规范
└── OPS-001_DEPLOYMENT.md          # 部署运维规范
```

### 规则冲突处理
1. **优先级判断**: 按上述优先级处理
2. **规则合并**: 合并相似规则
3. **规则废弃**: 标记过时规则为废弃状态

## 🚀 规则应用指南

### 新任务开始
1. **检查规则**: 阅读本汇总文档
2. **选择通道**: 根据任务复杂度选择对应通道
3. **应用规则**: 在任务执行中严格遵守相关规则
4. **规则验证**: 验证规则在任务中的有效性

### 代码审查
1. **数据库设计**: 检查主键命名和关联逻辑
2. **模块结构**: 检查配置类和工具类位置
3. **API设计**: 检查路由命名和响应格式
4. **性能优化**: 检查启动性能和查询优化

### 文档维护
1. **规则同步**: 确保代码实现与规则一致
2. **规则更新**: 及时更新过时规则
3. **规则推广**: 在团队中推广规则使用

## 📊 规则执行状态

### 已确认规则
- ✅ **DB-001**: 数据库主键命名规范
- ✅ **ARCH-001**: 微服务架构设计规则
- ✅ **ARCH-002**: 模块配置管理规范
- ✅ **CONFIG-001**: 配置文件分离规则
- ✅ **API-001**: API路由命名规范
- ✅ **DEV-001**: JSON处理选择规范
- ✅ **DEV-002**: MyBatis-Plus分页查询开发规则
- ✅ **DEP-001**: MyBatis-Plus Maven BOM安装管理
- ✅ **PERF-001**: Spring Boot启动性能优化

### 待验证规则
- 🔄 **SEC-001**: 安全认证规范
- 🔄 **OPS-001**: 部署运维规范

### 待完善规则
- ⏳ **API-002**: API响应格式规范
- ⏳ **DEV-003**: 测试策略规范
- ⏳ **OPS-001**: 部署规范

### 新增模板
- ✅ **MODULE_DESIGN_TEMPLATE**: 模块设计文档模板（基于service-auth设计文档）
- ✅ **MODULE_DESIGN_EXAMPLE**: 模块设计文档使用示例
- ✅ **API_TEST_TEMPLATE**: API测试文档模板（REST接口与Feign客户端分离）
- ✅ **API_TEST_EXAMPLE**: API测试文档使用示例

## 🔍 规则检查清单

### 数据库开发检查 (DB-001)
- [ ] 主键是否使用 `表名_id` 格式
- [ ] 主键类型是否为 `VARCHAR(32)`
- [ ] 是否避免使用外键约束
- [ ] 索引命名是否符合规范
- [ ] 是否使用INT存储枚举

### 微服务架构检查 (ARCH-001)
- [ ] 服务分层是否合理
- [ ] 服务职责是否单一
- [ ] 依赖关系是否清晰
- [ ] 端口分配是否规范
- [ ] 配置管理是否分离

### 模块开发检查 (ARCH-002)
- [ ] 配置类是否在 `service-base` 模块
- [ ] 工具类是否在 `service-common` 模块
- [ ] 文档是否在 `zinfra/moudleDocs/` 下
- [ ] 是否注明Feign使用情况

### API开发检查 (API-001)
- [ ] 路由是否使用 `/service/<entity>` 格式
- [ ] 是否使用 `success()` 方法返回成功响应
- [ ] 是否使用 FastJSON2 处理JSON
- [ ] 响应格式是否统一

### 项目规范检查 (DEV-001)
- [ ] 代码作者是否为 scccy
- [ ] 是否使用中文文档
- [ ] 是否使用 Lombok `@Data` 注解
- [ ] 是否遵循性能优化规则 (PERF-001)

### MyBatis-Plus分页查询检查 (DEV-002)
- [ ] 是否配置MyBatis-Plus分页插件
- [ ] 是否使用 `IPage<T>` 接口进行分页查询
- [ ] 是否在Service层处理分页逻辑
- [ ] 是否设置合理的分页大小限制
- [ ] 是否为分页查询字段创建索引
- [ ] 是否实现分页参数验证

### MyBatis-Plus BOM管理检查 (DEP-001)
- [ ] 是否配置 `mybatis-plus-bom` 依赖管理
- [ ] 是否引入正确的Starter依赖
- [ ] 是否引入正确的jsqlparser版本
- [ ] 是否移除冲突的MyBatis依赖
- [ ] 是否验证依赖版本兼容性

### 配置文件检查 (CONFIG-001)
- [ ] 是否分离本地配置和远程配置
- [ ] 是否使用环境变量管理敏感信息
- [ ] 是否按环境组织配置文件
- [ ] 是否包含配置说明文档
- [ ] 是否遵循配置加载顺序

---

**版本**: v2.0  
**创建日期**: 2025-08-04  
**最后更新**: 2025-08-04  
**维护者**: scccy 