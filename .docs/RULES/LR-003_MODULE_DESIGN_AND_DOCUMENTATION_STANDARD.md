# 模块设计与文档标准化规则

**ID**: LR-003  
**Name**: 模块设计与文档标准化规则  
**Status**: Active  
**创建时间**: 2025-08-01  
**合并来源**: LR-002_MODULE_DESIGN_FIRST.md + DEV-011_MODULE_DOCUMENTATION_STANDARD.md

## 触发情景 (Context/Trigger)
当需要新建微服务模块、对已有模块进行迭代或重构时，必须遵循设计优先原则和标准化的文档结构。

## 指令 (Directive)

### 1. 设计优先原则
- **必须 (MUST)** 在开始编码前查看 `infra/moudleDocs/` 目录下的相关设计文档
- **必须 (MUST)** 根据设计文档中的接口定义、数据模型和功能特性来生成代码
- **禁止 (MUST NOT)** 在没有设计文档的情况下开始模块开发
- **必须 (MUST)** 严格按照设计文档中的接口定义生成Controller
- **必须 (MUST)** 根据设计文档中的数据模型生成Entity和DTO
- **必须 (MUST)** 实现设计文档中定义的所有功能特性

### 2. 标准化文档结构
- **必须 (MUST)** 每个模块在 `infra/moudleDocs/` 下包含6个标准化文档
- **必须 (MUST)** 按照标准命名规范创建文档
- **必须 (MUST)** 使用统一的文档命名规范（中文或英文均可，但要保持一致性）

#### 2.1 必需文档清单
```
infra/moudleDocs/{模块名称}/
├── 模块主体讨论.md           # 模块需求讨论和功能规划
├── 模块设计.md              # 模块详细设计文档
├── API接口说明.md           # API接口详细说明
├── API接口测试.md           # API接口测试文档
├── 模块迭代说明.md          # 模块迭代需求说明
└── 模块迭代设计.md          # 模块迭代设计文档
```

#### 2.2 设计文档结构要求
- **必须 (MUST)** 确保设计文档包含以下内容：
  - 模块概述和功能描述
  - **当前微服务模块级别以及父模块信息** - 明确模块在微服务架构中的层级关系
  - **接口功能列表（Excel表格格式）** - 包含序号、接口名称、请求方法、接口路径、功能描述、职责对应、是否需要Feign客户端、详细文档说明链接
  - **数据模型设计** - 指向 `infra/database/data/` 目录下的SQL文件，不重复定义表结构
  - **接口设计** - 包含请求参数和响应格式，支持跳转链接，不包含详细Java代码
  - 功能特性列表
  - 技术实现方案
  - 项目结构说明
  - 依赖关系定义

#### 2.3 接口功能列表格式要求
- **必须 (MUST)** 使用Excel表格格式展示接口列表
- **必须 (MUST)** 包含以下列：序号、接口名称、请求方法、接口路径、功能描述、职责对应、是否需要Feign客户端、详细说明
- **必须 (MUST)** 在"详细说明"列提供可点击的跳转链接到对应的接口详细设计
- **必须 (MUST)** 按功能模块分类组织接口列表
- **必须 (MUST)** 接口路径符合微服务模块名称+具体实现的命名规范（如：/service/user、/core/publisher等）

#### 2.4 接口设计跳转要求
- **必须 (MUST)** 为每个接口分类标题添加锚点ID，格式：`{#31-{接口分类名}}`
- **必须 (MUST)** 确保接口列表中的跳转链接能够正确导航到对应的详细说明
- **必须 (MUST)** 保持接口设计与接口列表的一致性

### 3. 新建模块工作流程（第一套框架）
- **必须 (MUST)** 按照5个步骤执行完整模块开发流程
- **必须 (MUST)** 每个步骤完成后获得用户确认
- **必须 (MUST)** 基于文档驱动进行开发
- **禁止 (MUST NOT)** 跳过任何步骤或用户确认环节

#### 3.1 步骤1：生成文件夹及模块主体讨论
- **必须 (MUST)** 在 `infra/moudleDocs/` 下创建模块文件夹
- **必须 (MUST)** 创建 `模块主体讨论.md` 文档
- **必须 (MUST)** 用户描述模块需求和功能范围
- **必须 (MUST)** 明确模块背景、目标、范围

#### 3.2 步骤2：功能拆分与模块确认
- **必须 (MUST)** AI总结主题内容并生成功能拆分建议
- **必须 (MUST)** 按业务功能、管理功能、接口功能、集成功能维度拆分
- **必须 (MUST)** 用户确认功能拆分方案
- **禁止 (MUST NOT)** 在用户未确认前进入下一步

#### 3.3 步骤3：设计模板生成
- **必须 (MUST)** 基于确认的功能拆分生成模块设计文档
- **必须 (MUST)** 设计数据库表结构、API接口规范、业务逻辑流程
- **必须 (MUST)** 填写核心注意事项（关键约束、特殊要求、风险提示、依赖关系）
- **必须 (MUST)** 用户确认设计模板
- **必须 (MUST)** 包含架构设计、数据设计、接口设计、安全设计、性能设计

#### 3.4 步骤4：API接口文档生成
- **必须 (MUST)** 基于模块设计生成API接口说明文档
- **必须 (MUST)** 详细设计每个API接口的请求参数和响应格式
- **必须 (MUST)** 标识哪些接口需要提供Feign客户端
- **必须 (MUST)** 生成API接口测试文档
- **必须 (MUST)** 用户确认API接口设计

#### 3.5 步骤5：微服务开发
- **必须 (MUST)** 按照模块设计开始开发对应的微服务
- **必须 (MUST)** 实现Feign客户端供其他微服务使用
- **必须 (MUST)** 完成项目结构搭建、数据库表创建、代码实现、配置和测试
- **必须 (MUST)** 用户确认功能实现和测试结果

### 4. 模块迭代工作流程（第二套框架）
- **必须 (MUST)** 按照5个步骤执行模块迭代流程
- **必须 (MUST)** 支持多次迭代，按日期标记迭代版本
- **必须 (MUST)** 确保文档与代码实现同步更新
- **禁止 (MUST NOT)** 在文档未更新的情况下发布迭代

#### 4.1 步骤1：生成迭代模板
- **必须 (MUST)** 创建 `模块迭代说明_YYYYMMDD_迭代描述.md` 文档
- **必须 (MUST)** 用户描述迭代需求和功能扩展
- **必须 (MUST)** 记录迭代版本和时间信息
- **必须 (MUST)** 明确迭代目标、范围、需求

#### 4.2 步骤2：功能拆分与确认
- **必须 (MUST)** AI分析迭代主题内容
- **必须 (MUST)** 将主题拆分成多个接口和功能点
- **必须 (MUST)** 分析对现有功能的影响
- **必须 (MUST)** 用户确认功能拆分方案

#### 4.3 步骤3：迭代设计生成
- **必须 (MUST)** 基于确认的功能拆分生成迭代设计文档
- **必须 (MUST)** 设计新增的数据库表结构、API接口、业务逻辑变更
- **必须 (MUST)** 用户确认迭代设计方案
- **必须 (MUST)** 包含兼容性设计

#### 4.4 步骤4：迭代开发
- **必须 (MUST)** 按照迭代设计进行开发
- **必须 (MUST)** 实现新增功能并集成到现有模块
- **必须 (MUST)** 更新Feign客户端
- **必须 (MUST)** 测试验证新功能

#### 4.5 步骤5：文档更新
- **必须 (MUST)** 更新设计模板、API接口、测试文档
- **必须 (MUST)** 确保文档与代码实现一致
- **必须 (MUST)** 更新模块迭代说明文档
- **必须 (MUST)** 用户确认文档更新完整性

### 5. 代码生成规范
- **必须 (MUST)** 严格按照设计文档中的接口定义生成Controller
- **必须 (MUST)** 根据设计文档中的数据模型生成Entity和DTO
- **必须 (MUST)** 实现设计文档中定义的所有功能特性
- **必须 (MUST)** 遵循设计文档中的项目结构和依赖关系

### 6. 文档管理规范
- **必须 (MUST)** 使用标准化的文档模板
- **必须 (MUST)** 及时更新相关文档
- **必须 (MUST)** 重要文档变更需要团队评审
- **必须 (MUST)** 定期检查文档的完整性和准确性
- **禁止 (MUST NOT)** 文档与代码实现不一致

### 7. 质量保证要求
- **必须 (MUST)** 每个阶段都要进行质量检查
- **必须 (MUST)** 所有代码必须经过审查
- **必须 (MUST)** 每个功能都要进行测试验证
- **必须 (MUST)** 确保文档与代码实现一致
- **必须 (MUST)** 重要功能要进行性能测试
- **必须 (MUST)** 在完成代码生成后验证是否完全符合设计文档
- **必须 (MUST)** 确认所有接口、数据模型和功能特性都已实现

### 8. 接口测试要求
- **必须 (MUST)** 为每个模块创建对应的接口测试文档
- **必须 (MUST)** 使用Excel表格格式展示接口列表，包含序号、接口名称、请求方法、接口路径、功能描述、测试详情
- **必须 (MUST)** 在"测试详情"列提供可点击的跳转链接到对应的测试用例
- **必须 (MUST)** 包含完整的curl命令示例、错误场景测试、性能测试和自动化测试脚本
- **必须 (MUST)** 提供测试数据准备和清理的SQL脚本
- **必须 (MUST)** 根据API测试文件执行接口测试，验证输入输出值
- **必须 (MUST)** 验证异常场景处理和错误码返回
- **必须 (MUST)** 确认接口性能指标和并发处理能力

## 理由 (Justification)
此规则合并了LR-002模块设计优先规则和DEV-011模块文档标准化规则，确保模块开发的一致性和规范性。通过设计文档优先的原则和标准化的文档结构，可以：
1. 确保代码实现与业务需求的一致性
2. 提高代码质量和可维护性
3. 减少返工和重构的成本
4. 便于团队协作和代码审查
5. 建立标准化的开发流程
6. 提高开发效率和项目质量

## 最佳实践
1. **文档先行**: 先完成文档设计，再进行代码开发
2. **用户确认**: 每个关键步骤都需要用户确认
3. **模板驱动**: 使用标准化的文档模板
4. **版本控制**: 重要变更需要版本标记
5. **同步更新**: 确保文档与代码实现同步
6. **质量检查**: 每个阶段都要进行质量检查

## 检查清单
- [ ] 模块是否包含6个必需文档
- [ ] 文档命名是否符合规范
- [ ] 是否按照工作流程执行
- [ ] 每个步骤是否获得用户确认
- [ ] 文档是否与代码实现一致
- [ ] 是否进行了质量检查
- [ ] 重要文档是否经过评审
- [ ] 迭代文档是否按日期标记
- [ ] 设计文档是否包含完整的接口功能列表
- [ ] 接口设计是否支持跳转链接
- [ ] 代码实现是否完全符合设计文档

## 示例
当需要开发用户模块时：
1. 创建模块目录：`infra/moudleDocs/service-user/`
2. 创建 `模块主体讨论.md` 进行需求讨论
3. 基于功能拆分生成 `模块设计.md`，包含：
   - 当前微服务模块级别：service-user（用户服务）
   - 父模块：service（服务层）
   - 数据模型设计指向：`infra/database/data/user/user_init_creat_optimized.sql`
4. 生成 `API接口说明.md` 和 `API接口测试.md`
5. 在接口功能列表中使用Excel表格格式：
   ```markdown
   | 序号 | 接口名称 | 请求方法 | 接口路径 | 功能描述 | 职责对应 | 是否需要Feign客户端 | 详细说明 |
   |------|----------|----------|----------|----------|----------|-------------------|----------|
   | 1 | 创建用户 | POST | `/service/user` | 创建新用户 | 用户管理 | 否 | [查看详情](#31-用户基础信息管理接口) |
   | 2 | 用户登录 | POST | `/service/auth/login` | 用户登录认证 | 认证管理 | 是 | [查看详情](#32-用户认证管理接口) |
   ```
6. 为接口分类添加锚点ID：`### 3.1 用户基础信息管理接口 {#31-用户基础信息管理接口}`
7. 根据文档中的接口定义生成UserController
8. 根据文档中的数据模型生成User实体类
9. 实现文档中定义的所有功能特性
10. 执行接口测试验证功能
11. 验证实现是否完全符合设计文档

## 相关规则
- DEV-007: 网关接口同步规则
- DEV-008: 文档管理规则
- API-DOC-001: API文档规范 