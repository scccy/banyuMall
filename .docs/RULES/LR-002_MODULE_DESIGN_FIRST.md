# 模块设计优先规则

**ID**: LR-002  
**Name**: 模块设计优先规则  
**Status**: Active  
**创建时间**: 2025-01-27  

## 触发情景 (Context/Trigger)
当需要新建或重构任何模块时，必须首先查看 `infra/moudleDocs/` 目录下的模块设计文档。

## 指令 (Directive)

### 1. 设计文档优先原则
- **必须 (MUST)** 在开始编码前查看 `infra/moudleDocs/` 目录下的相关设计文档
- **必须 (MUST)** 根据设计文档中的接口定义、数据模型和功能特性来生成代码
- **禁止 (MUST NOT)** 在没有设计文档的情况下开始模块开发

### 2. 设计文档结构要求
- **必须 (MUST)** 确保设计文档包含以下内容：
  - 模块概述和功能描述
  - **接口功能列表（Excel表格格式）** - 包含序号、接口名称、请求方法、接口路径、功能描述、职责对应、详细说明链接
  - 数据模型设计（包含SQL表结构）
  - 接口设计（包含请求参数和响应格式，支持跳转链接）
  - 功能特性列表
  - 技术实现方案
  - 项目结构说明
  - 依赖关系定义

### 2.1 接口功能列表格式要求
- **必须 (MUST)** 使用Excel表格格式展示接口列表
- **必须 (MUST)** 包含以下列：序号、接口名称、请求方法、接口路径、功能描述、职责对应、详细说明
- **必须 (MUST)** 在"详细说明"列提供可点击的跳转链接到对应的接口详细设计
- **必须 (MUST)** 按功能模块分类组织接口列表

### 2.2 接口设计跳转要求
- **必须 (MUST)** 为每个接口分类标题添加锚点ID，格式：`{#31-{接口分类名}}`
- **必须 (MUST)** 确保接口列表中的跳转链接能够正确导航到对应的详细说明
- **必须 (MUST)** 保持接口设计与接口列表的一致性

### 3. 代码生成规范
- **必须 (MUST)** 严格按照设计文档中的接口定义生成Controller
- **必须 (MUST)** 根据设计文档中的数据模型生成Entity和DTO
- **必须 (MUST)** 实现设计文档中定义的所有功能特性
- **必须 (MUST)** 遵循设计文档中的项目结构和依赖关系

### 4. 设计文档更新
- **必须 (MUST)** 在代码实现过程中同步更新设计文档
- **必须 (MUST)** 记录实现过程中的任何设计变更
- **必须 (MUST)** 确保设计文档与实际代码保持一致

### 4.1 接口测试文档要求
- **必须 (MUST)** 为每个模块创建对应的接口测试文档
- **必须 (MUST)** 使用Excel表格格式展示接口列表，包含序号、接口名称、请求方法、接口路径、功能描述、测试详情
- **必须 (MUST)** 在"测试详情"列提供可点击的跳转链接到对应的测试用例
- **必须 (MUST)** 包含完整的curl命令示例、错误场景测试、性能测试和自动化测试脚本
- **必须 (MUST)** 提供测试数据准备和清理的SQL脚本

### 4.2 开发文档生成要求
- **必须 (MUST)** 根据设计模板生成具体的开发文档
- **必须 (MUST)** 明确列出实现该接口或功能需要的所有文件
- **必须 (MUST)** 对于Java类，详细说明该类需要什么方法，每个方法实现什么功能
- **必须 (MUST)** 使用文字逻辑描述或数据流图说明实现逻辑，不需要具体代码
- **必须 (MUST)** 包含数据流向、业务逻辑流程和异常处理机制
- **必须 (MUST)** 明确标注各组件之间的依赖关系和调用顺序

### 4.3 接口执行测试验证要求
- **必须 (MUST)** 根据API测试文件生成接口执行测试
- **必须 (MUST)** 验证接口是否满足设计文档中定义的输入输出值
- **必须 (MUST)** 检查请求参数格式、响应数据结构和业务逻辑正确性
- **必须 (MUST)** 验证异常场景处理和错误码返回
- **必须 (MUST)** 确认接口性能指标和并发处理能力
- **必须 (MUST)** 记录测试结果并与设计文档进行对比验证

### 5. 验证和确认
- **必须 (MUST)** 在完成代码生成后验证是否完全符合设计文档
- **必须 (MUST)** 确认所有接口、数据模型和功能特性都已实现
- **必须 (MUST)** 在任务状态文件中记录设计文档的引用

## 理由 (Justification)
此规则源于用户明确要求，确保模块开发的一致性和规范性。通过设计文档优先的原则，可以：
1. 确保代码实现与业务需求的一致性
2. 提高代码质量和可维护性
3. 减少返工和重构的成本
4. 便于团队协作和代码审查

## 执行流程
1. **创建模块目录**: 在 `infra/moudleDocs/` 目录下创建 `{模块名称}/` 文件夹
2. **使用模板**: 基于 `infra/moudleDocs/xxxxxx-design_templates.md` 和 `infra/moudleDocs/xxxxxx-api-test-template.md` 创建新模块文档
3. **创建设计文档**: 在 `infra/moudleDocs/{模块名称}/` 目录下创建 `design.md` 文件
4. **创建测试文档**: 在 `infra/moudleDocs/{模块名称}/` 目录下创建 `api-test.md` 文件
5. **生成开发文档**: 根据设计模板生成具体的开发文档，列出所需文件和类方法
6. **查看设计文档**: 首先查看 `infra/moudleDocs/{模块名称}/design.md` 设计文档
7. **理解需求**: 仔细阅读设计文档中的模块概述、数据模型和接口设计
8. **确认技术方案**: 确认技术实现方案和项目结构
9. **生成代码**: 严格按照设计文档和开发文档生成相应的代码
10. **接口执行测试**: 根据API测试文件执行接口测试，验证输入输出值
11. **验证实现**: 验证代码实现是否完全符合设计文档
12. **更新文档**: 如有必要，同步更新设计文档

## 示例
当需要开发用户模块时：
1. 创建模块目录：`infra/moudleDocs/service-user/`
2. 基于 `infra/moudleDocs/xxxxxx-design_templates.md` 创建 `infra/moudleDocs/service-user/design.md`
3. 基于 `infra/moudleDocs/xxxxxx-api-test-template.md` 创建 `infra/moudleDocs/service-user/api-test.md`
4. **生成开发文档**：创建 `infra/moudleDocs/service-user/development.md`，包含：
   - 所需文件列表：UserController.java, UserService.java, UserMapper.java, User.java等
   - 类方法说明：UserController.createUser()方法实现用户创建逻辑，UserService.validateUser()方法实现用户验证等
   - 数据流图：请求→Controller→Service→Mapper→数据库
5. 在接口功能列表中使用Excel表格格式：
   ```markdown
   | 序号 | 接口名称 | 请求方法 | 接口路径 | 功能描述 | 职责对应 | Feign调用 | 详细说明 |
   |------|----------|----------|----------|----------|----------|-----------|----------|
   | 1 | 创建用户 | POST | `/user` | 创建新用户 | 用户管理 | 否 | [查看详情](#31-用户基础信息管理接口) |
   ```
6. 为接口分类添加锚点ID：`### 3.1 用户基础信息管理接口 {#31-用户基础信息管理接口}`
7. 根据文档中的接口定义生成UserController
8. 根据文档中的数据模型生成User实体类
9. 实现文档中定义的所有功能特性
10. **接口执行测试**：根据api-test.md执行curl命令，验证输入输出值是否符合设计文档
11. 验证实现是否完全符合设计文档
12. 使用接口测试文档进行功能验证 