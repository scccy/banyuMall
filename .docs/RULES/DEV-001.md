# 编码规范规则

**ID**: DEV-001  
**Name**: 编码规范  
**Status**: Active  
**创建时间**: 2024-12-19  

## 触发情景 (Context/Trigger)
当进行任何Java代码开发时，必须严格遵守本规范。

## 指令 (Directive)

### 1. 命名规范

#### 类命名
- **实体类**: 使用名词，如 `User`, `Task`, `Points`
- **服务类**: 使用 `Service` 后缀，如 `UserService`, `TaskService`
- **控制器类**: 使用 `Controller` 后缀，如 `UserController`
- **配置类**: 使用 `Config` 后缀，如 `JwtConfig`
- **工具类**: 使用 `Util` 后缀，如 `JwtUtil`

#### 方法命名
- **查询方法**: 使用 `get`, `find`, `query` 前缀
- **创建方法**: 使用 `create`, `save` 前缀
- **更新方法**: 使用 `update`, `modify` 前缀
- **删除方法**: 使用 `delete`, `remove` 前缀
- **业务方法**: 使用动词+名词，如 `assignTask`, `calculatePoints`

#### 变量命名
- **常量**: 全大写+下划线，如 `MAX_POINTS`
- **变量**: 驼峰命名，如 `userName`, `taskId`
- **布尔变量**: 使用 `is`, `has`, `can` 前缀，如 `isActive`

### 2. 代码结构

#### 包结构
```
com.origin.banyumall
├── config/          # 配置类
├── controller/      # 控制器
├── service/         # 服务层
│   ├── impl/       # 服务实现
├── mapper/          # 数据访问层
├── entity/          # 实体类
├── dto/             # 数据传输对象
├── vo/              # 视图对象
├── common/          # 公共类
│   ├── result/      # 结果封装
│   ├── exception/   # 异常处理
│   ├── util/        # 工具类
```

#### 类结构顺序
1. 包声明
2. 导入语句
3. 类注释
4. 类声明
5. 常量定义
6. 成员变量
7. 构造方法
8. 公共方法
9. 私有方法

### 3. 注释规范

#### 类注释
```java
/**
 * 用户服务类
 * 
 * @author [作者名]
 * @since 2024-12-19
 */
```

#### 方法注释
```java
/**
 * 根据用户ID查询用户信息
 * 
 * @param userId 用户ID
 * @return 用户信息
 * @throws UserNotFoundException 用户不存在时抛出
 */
```

#### 行注释
- 使用 `//` 进行行注释
- 注释内容要简洁明了
- 复杂逻辑必须添加注释

### 4. 异常处理

#### 异常定义
- 自定义异常继承 `RuntimeException`
- 异常类名以 `Exception` 结尾
- 提供有意义的错误信息

#### 异常处理原则
- 不要忽略异常，必须处理或记录
- 使用统一的异常处理机制
- 敏感信息不要暴露在异常信息中

### 5. 数据库操作

#### SQL规范
- 使用MyBatis-Plus的注解方式
- 复杂查询使用XML配置
- 避免N+1查询问题
- 使用分页查询处理大数据量

#### 事务处理
- 在Service层使用 `@Transactional`
- 明确指定事务传播行为
- 合理设置事务超时时间

### 6. 安全规范

#### 数据验证
- 使用 `@Valid` 进行参数验证
- 自定义验证注解处理业务逻辑
- 敏感数据必须加密存储

#### 权限控制
- 使用 `@PreAuthorize` 进行方法级权限控制
- 在Controller层进行权限校验
- 记录敏感操作的日志

### 7. 性能规范

#### 缓存使用
- 合理使用Redis缓存
- 缓存键使用有意义的命名
- 设置合理的缓存过期时间

#### 数据库优化
- 合理使用索引
- 避免全表扫描
- 使用批量操作提高性能

### 8. 测试规范

#### 单元测试
- 每个Service方法都要有对应的测试
- 测试覆盖率不低于80%
- 使用Mock对象隔离依赖

#### 集成测试
- 测试API接口的完整流程
- 验证数据库操作的正确性
- 测试异常情况的处理

## 理由 (Justification)
此规范确保代码的可读性、可维护性和一致性，提高团队开发效率，减少代码审查时间。

## 检查清单

### 代码提交前检查
- [ ] 代码符合命名规范
- [ ] 添加了必要的注释
- [ ] 异常处理完善
- [ ] 通过了单元测试
- [ ] 代码格式化完成
- [ ] 没有敏感信息泄露

### 代码审查要点
- [ ] 业务逻辑正确性
- [ ] 性能影响评估
- [ ] 安全性考虑
- [ ] 可维护性评估
- [ ] 测试覆盖度检查 