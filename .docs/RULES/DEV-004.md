# Git提交规范规则

**ID**: DEV-004  
**Name**: Git提交规范  
**Status**: Active  
**创建时间**: 2025-07-30  

## 触发情景 (Context/Trigger)
当完成任何代码修改、功能开发、Bug修复或配置更改后，必须按照本规范进行Git提交。

## 指令 (Directive)

### 1. 提交时机

#### 必须提交的情况
- **功能开发完成**: 新功能开发完成并通过测试
- **Bug修复完成**: 问题修复并验证通过
- **代码重构**: 代码结构优化完成
- **配置更改**: 配置文件修改完成
- **文档更新**: 技术文档或注释更新
- **依赖更新**: 第三方依赖版本更新

#### 禁止提交的情况
- **未完成的代码**: 功能未完成或存在明显错误
- **测试代码**: 临时测试代码或调试代码
- **敏感信息**: 包含密码、密钥等敏感信息
- **编译错误**: 存在编译错误或语法错误

### 2. 提交信息格式

#### 标准格式
```
<类型>(<范围>): <简短描述>

<详细描述>

<相关链接>
```

#### 类型说明
- **feat**: 新功能
- **fix**: Bug修复
- **docs**: 文档更新
- **style**: 代码格式调整（不影响功能）
- **refactor**: 代码重构
- **perf**: 性能优化
- **test**: 测试相关
- **chore**: 构建过程或辅助工具的变动
- **ci**: CI/CD相关更改
- **build**: 构建系统或外部依赖更改

#### 范围说明
- **auth**: 认证授权相关
- **user**: 用户管理相关
- **base**: 基础模块相关
- **gateway**: 网关相关
- **config**: 配置相关
- **db**: 数据库相关
- **api**: API接口相关
- **security**: 安全相关

### 3. 提交信息示例

#### 新功能开发
```
feat(user): 添加用户注册功能

- 实现用户注册接口
- 添加邮箱验证功能
- 集成短信验证码服务
- 添加用户注册测试用例

Closes #123
```

#### Bug修复
```
fix(auth): 修复JWT令牌过期时间计算错误

- 修正JWT令牌过期时间计算逻辑
- 添加令牌过期时间验证
- 更新相关单元测试

Fixes #456
```

#### 代码重构
```
refactor(base): 重构ResultData类结构

- 优化ResultData类的泛型支持
- 简化成功和失败响应的创建方法
- 添加更详细的错误信息支持
- 更新所有使用ResultData的地方

BREAKING CHANGE: ResultData构造函数参数顺序调整
```

#### 文档更新
```
docs(api): 更新API文档配置说明

- 添加Knife4j配置详细说明
- 更新API文档访问地址
- 添加测试接口使用示例
- 完善故障排除指南
```

### 4. 提交前检查

#### 代码检查
- [ ] 代码编译通过
- [ ] 单元测试通过
- [ ] 代码格式正确
- [ ] 没有敏感信息
- [ ] 注释完整

#### 提交信息检查
- [ ] 类型选择正确
- [ ] 范围描述准确
- [ ] 简短描述清晰
- [ ] 详细描述完整
- [ ] 相关链接正确

### 5. 分支管理

#### 分支命名规范
- **功能分支**: `feature/功能名称`
- **Bug修复分支**: `fix/问题描述`
- **热修复分支**: `hotfix/紧急问题`
- **发布分支**: `release/版本号`

#### 分支操作流程
1. 从主分支创建功能分支
2. 在功能分支上开发
3. 完成开发后提交代码
4. 创建Pull Request
5. 代码审查通过后合并

### 6. 提交频率

#### 推荐频率
- **小功能**: 1-2次提交
- **中等功能**: 3-5次提交
- **大功能**: 5-10次提交
- **重构**: 根据重构范围决定

#### 提交原则
- **原子性**: 每次提交只包含一个完整的变更
- **一致性**: 提交后代码应该能够正常编译和运行
- **可追溯性**: 提交信息要能够清楚描述变更内容

### 7. 特殊情况处理

#### 紧急修复
```
hotfix(security): 紧急修复SQL注入漏洞

- 修复用户查询接口的SQL注入问题
- 添加参数验证和转义处理
- 立即部署到生产环境

URGENT: 安全漏洞修复
```

#### 回滚提交
```
revert(feature): 回滚用户注册功能

- 由于性能问题，暂时回滚用户注册功能
- 保留相关代码，等待优化后重新启用

Reverts commit abc123
```

## 理由 (Justification)
规范的Git提交信息能够：
1. **提高代码可追溯性**: 清楚记录每次变更的目的和内容
2. **便于代码审查**: 审查者能够快速理解变更内容
3. **自动化处理**: 支持自动生成变更日志和版本发布说明
4. **团队协作**: 提高团队协作效率和代码质量
5. **问题定位**: 便于快速定位和修复问题

## 检查清单

### 提交前检查
- [ ] 代码编译通过
- [ ] 单元测试通过
- [ ] 代码格式正确
- [ ] 没有敏感信息
- [ ] 注释完整
- [ ] 提交信息格式正确
- [ ] 提交信息内容完整

### 提交后检查
- [ ] 提交成功
- [ ] 提交信息清晰
- [ ] 相关链接正确
- [ ] 分支名称规范
- [ ] 代码审查通过

## 工具支持

### Git Hooks
建议配置pre-commit hook进行自动化检查：
- 代码格式检查
- 单元测试执行
- 敏感信息检查
- 提交信息格式验证

### IDE插件
推荐使用以下IDE插件：
- **GitLens**: 增强Git功能
- **Conventional Commits**: 提交信息格式化
- **Git History**: 查看Git历史

## 相关链接

- [Conventional Commits规范](https://www.conventionalcommits.org/)
- [Angular提交规范](https://github.com/angular/angular/blob/main/CONTRIBUTING.md#-commit-message-format)
- [Git提交最佳实践](https://git-scm.com/book/zh/v2/Git-%E5%9F%BA%E7%A1%80-%E8%AE%B0%E5%BD%95%E6%AF%8F%E6%AC%A1%E6%9B%B4%E6%96%B0%E5%88%B0%E4%BB%93%E5%BA%93) 