# Service Common æ¨¡å—è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

**æ¨¡å—åç§°**: service-common  
**æ¨¡å—ç±»å‹**: é€šç”¨å·¥å…·æ¨¡å—  
**æŠ€æœ¯æ ˆ**: Spring Boot + FastJSON2 + JWT + Log4j2  
**ä½œè€…**: scccy  
**åˆ›å»ºæ—¶é—´**: 2025-07-31  

### æ¨¡å—èŒè´£
- **ç»Ÿä¸€å“åº”æ ¼å¼**: æä¾›ç»Ÿä¸€çš„APIå“åº”æ•°æ®ç»“æ„
- **å¼‚å¸¸å¤„ç†**: æä¾›ç»Ÿä¸€çš„ä¸šåŠ¡å¼‚å¸¸å¤„ç†æœºåˆ¶
- **å·¥å…·ç±»**: æä¾›é€šç”¨çš„å·¥å…·ç±»å’Œè¾…åŠ©æ–¹æ³•
- **æšä¸¾å®šä¹‰**: å®šä¹‰ç³»ç»Ÿä¸­ä½¿ç”¨çš„æšä¸¾ç±»å‹
- **åŸºç¡€å®ä½“**: æä¾›åŸºç¡€å®ä½“ç±»å’Œé€šç”¨å­—æ®µ
- **æ—¥å¿—é…ç½®**: æä¾›ç»Ÿä¸€çš„æ—¥å¿—é…ç½®

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æŠ€æœ¯æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¾®æœåŠ¡é›†ç¾¤     â”‚â”€â”€â”€â–¶â”‚  Service Common  â”‚â”€â”€â”€â–¶â”‚   é€šç”¨ç»„ä»¶      â”‚
â”‚                â”‚    â”‚                â”‚    â”‚                â”‚
â”‚ - core-publisherâ”‚    â”‚ - ç»Ÿä¸€å“åº”æ ¼å¼  â”‚    â”‚ - ResultData   â”‚
â”‚ - service-user  â”‚    â”‚ - å¼‚å¸¸å¤„ç†      â”‚    â”‚ - BusinessExceptionâ”‚
â”‚ - service-auth  â”‚    â”‚ - å·¥å…·ç±»        â”‚    â”‚ - å·¥å…·ç±»        â”‚
â”‚ - service-gatewayâ”‚   â”‚ - æšä¸¾å®šä¹‰      â”‚    â”‚ - æšä¸¾ç±»        â”‚
â”‚ - third-party-* â”‚    â”‚ - åŸºç¡€å®ä½“      â”‚    â”‚ - åŸºç¡€å®ä½“      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ - æ—¥å¿—é…ç½®      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶
1. **ResultData**: ç»Ÿä¸€APIå“åº”æ•°æ®ç»“æ„
2. **BusinessException**: ä¸šåŠ¡å¼‚å¸¸å¤„ç†ç±»
3. **ErrorCode**: é”™è¯¯ç å®šä¹‰æšä¸¾
4. **BaseEntity**: åŸºç¡€å®ä½“ç±»
5. **UserUtils**: ç”¨æˆ·å·¥å…·ç±»
6. **ValidationUtils**: éªŒè¯å·¥å…·ç±»
7. **UserPermissionUtil**: ç”¨æˆ·æƒé™å·¥å…·ç±»

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### 1. ç»Ÿä¸€å“åº”æ ¼å¼ (ResultData)
- **æˆåŠŸå“åº”**: ç»Ÿä¸€çš„æˆåŠŸå“åº”æ ¼å¼
- **é”™è¯¯å“åº”**: ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼
- **åˆ†é¡µå“åº”**: æ”¯æŒåˆ†é¡µæ•°æ®çš„å“åº”æ ¼å¼
- **æ•°æ®åŒ…è£…**: è‡ªåŠ¨åŒ…è£…è¿”å›æ•°æ®

### 2. å¼‚å¸¸å¤„ç† (BusinessException)
- **ä¸šåŠ¡å¼‚å¸¸**: å¤„ç†ä¸šåŠ¡é€»è¾‘å¼‚å¸¸
- **é”™è¯¯ç æ˜ å°„**: ç»Ÿä¸€çš„é”™è¯¯ç å®šä¹‰
- **å¼‚å¸¸ä¿¡æ¯**: æ ‡å‡†åŒ–çš„å¼‚å¸¸ä¿¡æ¯æ ¼å¼
- **å¼‚å¸¸ä¼ æ’­**: æ”¯æŒå¼‚å¸¸åœ¨å¾®æœåŠ¡é—´ä¼ æ’­

### 3. å·¥å…·ç±»é›†åˆ
- **UserUtils**: ç”¨æˆ·ç›¸å…³å·¥å…·æ–¹æ³•
- **ValidationUtils**: æ•°æ®éªŒè¯å·¥å…·æ–¹æ³•
- **UserPermissionUtil**: ç”¨æˆ·æƒé™éªŒè¯å·¥å…·

### 4. æšä¸¾å®šä¹‰
- **UserStatusEnum**: ç”¨æˆ·çŠ¶æ€æšä¸¾
- **UserTypeEnum**: ç”¨æˆ·ç±»å‹æšä¸¾
- **ErrorCode**: é”™è¯¯ç æšä¸¾

### 5. åŸºç¡€å®ä½“
- **BaseEntity**: åŒ…å«é€šç”¨å­—æ®µçš„åŸºç¡€å®ä½“
- **RequestTrace**: è¯·æ±‚è¿½è¸ªä¿¡æ¯

## ğŸ“Š æ•°æ®æ¨¡å‹

### 1. ResultData (ç»Ÿä¸€å“åº”æ•°æ®ç»“æ„)
```java
public class ResultData<T> {
    private Integer code;           // å“åº”ç 
    private String message;         // å“åº”æ¶ˆæ¯
    private T data;                // å“åº”æ•°æ®
    private Long timestamp;         // æ—¶é—´æˆ³
    private String traceId;         // è¿½è¸ªID
}
```

### 2. BusinessException (ä¸šåŠ¡å¼‚å¸¸)
```java
public class BusinessException extends RuntimeException {
    private Integer code;           // é”™è¯¯ç 
    private String message;         // é”™è¯¯æ¶ˆæ¯
    private Object[] args;          // é”™è¯¯å‚æ•°
}
```

### 3. ErrorCode (é”™è¯¯ç æšä¸¾)
```java
public enum ErrorCode {
    SUCCESS(200, "æ“ä½œæˆåŠŸ"),
    PARAM_ERROR(400, "å‚æ•°é”™è¯¯"),
    UNAUTHORIZED(401, "æœªæˆæƒ"),
    FORBIDDEN(403, "ç¦æ­¢è®¿é—®"),
    NOT_FOUND(404, "èµ„æºä¸å­˜åœ¨"),
    INTERNAL_ERROR(500, "å†…éƒ¨æœåŠ¡å™¨é”™è¯¯");
    
    private final Integer code;
    private final String message;
}
```

### 4. BaseEntity (åŸºç¡€å®ä½“)
```java
public class BaseEntity {
    private LocalDateTime createdTime;  // åˆ›å»ºæ—¶é—´
    private LocalDateTime updatedTime;  // æ›´æ–°æ—¶é—´
    private String createdBy;           // åˆ›å»ºäºº
    private String updatedBy;           // æ›´æ–°äºº
    private Integer deleted;            // é€»è¾‘åˆ é™¤æ ‡è¯†
}
```

### 5. RequestTrace (è¯·æ±‚è¿½è¸ª)
```java
public class RequestTrace {
    private String traceId;         // è¿½è¸ªID
    private String userId;          // ç”¨æˆ·ID
    private String username;        // ç”¨æˆ·å
    private String ipAddress;       // IPåœ°å€
    private String userAgent;       // ç”¨æˆ·ä»£ç†
    private LocalDateTime timestamp; // æ—¶é—´æˆ³
}
```

## ğŸ”Œ æ¥å£è®¾è®¡

### 1. æ–‡ä»¶ä¸Šä¼ ç›¸å…³DTO

#### FileUploadRequest (æ–‡ä»¶ä¸Šä¼ è¯·æ±‚)
```java
public class FileUploadRequest {
    private String sourceService;   // æ¥æºæœåŠ¡
    private String businessType;    // ä¸šåŠ¡ç±»å‹
    private String filePath;        // æ–‡ä»¶è·¯å¾„
    private Long uploadUserId;      // ä¸Šä¼ ç”¨æˆ·ID
    private String uploadUserName;  // ä¸Šä¼ ç”¨æˆ·å
}
```

#### FileUploadResponse (æ–‡ä»¶ä¸Šä¼ å“åº”)
```java
public class FileUploadResponse {
    private Long fileId;            // æ–‡ä»¶ID
    private String originalName;    // åŸå§‹æ–‡ä»¶å
    private Long fileSize;          // æ–‡ä»¶å¤§å°
    private String mimeType;        // MIMEç±»å‹
    private String objectKey;       // OSSå¯¹è±¡é”®
    private String accessUrl;       // è®¿é—®URL
    private String bucketName;      // å­˜å‚¨æ¡¶åç§°
    private String filePath;        // æ–‡ä»¶è·¯å¾„
    private String sourceService;   // æ¥æºæœåŠ¡
    private String businessType;    // ä¸šåŠ¡ç±»å‹
    private Long uploadUserId;      // ä¸Šä¼ ç”¨æˆ·ID
    private String uploadUserName;  // ä¸Šä¼ ç”¨æˆ·å
    private LocalDateTime uploadTime; // ä¸Šä¼ æ—¶é—´
}
```

### 2. ç”¨æˆ·è®¤è¯ç›¸å…³DTO

#### LoginRequest (ç™»å½•è¯·æ±‚)
```java
public class LoginRequest {
    private String username;        // ç”¨æˆ·å
    private String password;        // å¯†ç 
    private String captcha;         // éªŒè¯ç 
    private String captchaId;       // éªŒè¯ç ID
}
```

#### LoginResponse (ç™»å½•å“åº”)
```java
public class LoginResponse {
    private String token;           // JWTä»¤ç‰Œ
    private String refreshToken;    // åˆ·æ–°ä»¤ç‰Œ
    private Long expiresIn;         // è¿‡æœŸæ—¶é—´
    private UserInfo userInfo;      // ç”¨æˆ·ä¿¡æ¯
}
```

### 3. åˆ†é¡µç›¸å…³DTO

#### PageResult (åˆ†é¡µç»“æœ)
```java
public class PageResult<T> {
    private List<T> records;        // æ•°æ®è®°å½•
    private Long total;             // æ€»è®°å½•æ•°
    private Long size;              // æ¯é¡µå¤§å°
    private Long current;           // å½“å‰é¡µç 
    private Long pages;             // æ€»é¡µæ•°
}
```

## ğŸ”’ å®‰å…¨è€ƒè™‘

### æ•°æ®å®‰å…¨
- **å‚æ•°éªŒè¯**: æ‰€æœ‰è¾“å…¥å‚æ•°è¿›è¡Œä¸¥æ ¼éªŒè¯
- **æ•°æ®è„±æ•**: æ•æ„Ÿæ•°æ®è‡ªåŠ¨è„±æ•å¤„ç†
- **æƒé™æ§åˆ¶**: ç»Ÿä¸€çš„æƒé™éªŒè¯æœºåˆ¶
- **æ—¥å¿—å®‰å…¨**: æ•æ„Ÿä¿¡æ¯ä¸è®°å½•åˆ°æ—¥å¿—

### æ¥å£å®‰å…¨
- **è¾“å…¥éªŒè¯**: æ‰€æœ‰è¾“å…¥è¿›è¡ŒéªŒè¯å’Œè¿‡æ»¤
- **å¼‚å¸¸å¤„ç†**: ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†ï¼Œé¿å…ä¿¡æ¯æ³„éœ²
- **è®¿é—®æ§åˆ¶**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
- **æ•°æ®åŠ å¯†**: æ•æ„Ÿæ•°æ®ä¼ è¾“åŠ å¯†

## ğŸ“Š ç›‘æ§ä¸æ—¥å¿—

### æ—¥å¿—é…ç½®
- **æ—¥å¿—æ¡†æ¶**: Log4j2
- **æ—¥å¿—çº§åˆ«**: INFO (ç”Ÿäº§ç¯å¢ƒ)
- **æ—¥å¿—æ ¼å¼**: ç»Ÿä¸€çš„æ—¥å¿—æ ¼å¼
- **æ—¥å¿—è½®è½¬**: 100MB/æ–‡ä»¶ï¼Œä¿ç•™30å¤©

### ç›‘æ§æŒ‡æ ‡
- **æ¥å£è°ƒç”¨æ¬¡æ•°**: ç»Ÿè®¡æ¥å£è°ƒç”¨é¢‘ç‡
- **å¼‚å¸¸ç»Ÿè®¡**: ç»Ÿè®¡å¼‚å¸¸å‘ç”Ÿæƒ…å†µ
- **å“åº”æ—¶é—´**: ç›‘æ§æ¥å£å“åº”æ—¶é—´
- **é”™è¯¯ç‡**: ç›‘æ§é”™è¯¯ç‡å˜åŒ–

## ğŸš€ éƒ¨ç½²è¯´æ˜

### ç¯å¢ƒè¦æ±‚
- **JDKç‰ˆæœ¬**: 21
- **å†…å­˜è¦æ±‚**: æœ€å°512MBï¼Œæ¨è1GB
- **ä¾èµ–æœåŠ¡**: æ— å¤–éƒ¨ä¾èµ–

### ä½¿ç”¨æ–¹å¼
```xml
<!-- åœ¨å…¶ä»–å¾®æœåŠ¡ä¸­å¼•å…¥ä¾èµ– -->
<dependency>
    <groupId>com.origin</groupId>
    <artifactId>service-common</artifactId>
    <version>0.0.1-SNAPSHOT</version>
</dependency>
```

### é…ç½®è¯´æ˜
```yaml
# æ—¥å¿—é…ç½®
logging:
  config: classpath:log4j2.xml
  level:
    com.origin.common: info
```

## ğŸ“ æ³¨æ„äº‹é¡¹

### ä½¿ç”¨è§„èŒƒ
1. **ç»Ÿä¸€å“åº”**: æ‰€æœ‰APIå¿…é¡»ä½¿ç”¨ResultDataåŒ…è£…å“åº”
2. **å¼‚å¸¸å¤„ç†**: ä½¿ç”¨BusinessExceptionå¤„ç†ä¸šåŠ¡å¼‚å¸¸
3. **é”™è¯¯ç **: ä½¿ç”¨ErrorCodeæšä¸¾å®šä¹‰é”™è¯¯ç 
4. **æ—¥å¿—è®°å½•**: ä½¿ç”¨ç»Ÿä¸€çš„æ—¥å¿—æ ¼å¼è®°å½•

### æ‰©å±•æ€§
1. **å·¥å…·ç±»æ‰©å±•**: æ–°å¢å·¥å…·ç±»éµå¾ªç°æœ‰è§„èŒƒ
2. **æšä¸¾æ‰©å±•**: æ–°å¢æšä¸¾éµå¾ªç°æœ‰å‘½åè§„èŒƒ
3. **DTOæ‰©å±•**: æ–°å¢DTOéµå¾ªç°æœ‰ç»“æ„è§„èŒƒ
4. **å¼‚å¸¸æ‰©å±•**: æ–°å¢å¼‚å¸¸ç»§æ‰¿BusinessException

### ç»´æŠ¤æ€§
1. **ä»£ç è§„èŒƒ**: éµå¾ªç»Ÿä¸€çš„ä»£ç è§„èŒƒ
2. **æ–‡æ¡£åŒæ­¥**: åŠæ—¶æ›´æ–°æ¥å£æ–‡æ¡£
3. **ç‰ˆæœ¬ç®¡ç†**: åˆç†çš„ç‰ˆæœ¬ç®¡ç†ç­–ç•¥
4. **å‘åå…¼å®¹**: ä¿æŒå‘åå…¼å®¹æ€§

## ğŸ”„ ç‰ˆæœ¬å†å²

### v1.0.0 (2025-07-31)
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- æä¾›åŸºç¡€çš„å·¥å…·ç±»å’Œç»„ä»¶
- å®ç°ç»Ÿä¸€çš„å“åº”æ ¼å¼å’Œå¼‚å¸¸å¤„ç†
- æä¾›ç”¨æˆ·è®¤è¯ç›¸å…³çš„DTO
- æä¾›æ–‡ä»¶ä¸Šä¼ ç›¸å…³çš„DTO
- æä¾›åˆ†é¡µç›¸å…³çš„DTO

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-07-31  
**ç»´æŠ¤äººå‘˜**: scccy 