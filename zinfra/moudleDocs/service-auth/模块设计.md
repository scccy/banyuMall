# service-auth æ¨¡å—è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

### åŸºæœ¬ä¿¡æ¯
- **æ¨¡å—åç§°**: service-auth
- **æ¨¡å—ç±»å‹**: å¾®æœåŠ¡æ¨¡å—
- **ä¸»è¦èŒè´£**: ç”¨æˆ·è®¤è¯ã€JWTä»¤ç‰Œç®¡ç†ã€å¯†ç åŠ å¯†éªŒè¯ã€ç”¨æˆ·ä¿¡æ¯ç®¡ç†
- **æŠ€æœ¯æ ˆ**: Spring Boot + Spring Security + JWT + MyBatis Plus + Redis
- **ä½œè€…**: scccy
- **åˆ›å»ºæ—¶é—´**: 2025-07-31

### è®¾è®¡ç†å¿µ
service-authæ¨¡å—ä½œä¸ºç³»ç»Ÿçš„è®¤è¯ä¸­å¿ƒï¼Œè´Ÿè´£æ‰€æœ‰ç”¨æˆ·çš„èº«ä»½éªŒè¯å’Œæˆæƒç®¡ç†ã€‚é‡‡ç”¨JWTä»¤ç‰Œæœºåˆ¶å®ç°æ— çŠ¶æ€è®¤è¯ï¼Œæ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²ã€‚æ¨¡å—è®¾è®¡éµå¾ªå•ä¸€èŒè´£åŸåˆ™ï¼Œä¸“æ³¨äºè®¤è¯ç›¸å…³çš„æ ¸å¿ƒåŠŸèƒ½ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒæ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Controller    â”‚    â”‚     Service     â”‚    â”‚     Mapper      â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ AuthController  â”‚â”€â”€â”€â–¶â”‚  AuthService    â”‚â”€â”€â”€â–¶â”‚  SysUserMapper  â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Interceptor   â”‚    â”‚      Util       â”‚    â”‚    Database     â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ JwtInterceptor  â”‚    â”‚  JwtUtil        â”‚    â”‚    sys_user     â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸šåŠ¡æ¨¡å‹
```
ç”¨æˆ·ç™»å½•æµç¨‹:
1. å®¢æˆ·ç«¯å‘é€ç™»å½•è¯·æ±‚
2. éªŒè¯ç”¨æˆ·åå¯†ç 
3. ç”ŸæˆJWTä»¤ç‰Œ
4. è¿”å›ç”¨æˆ·ä¿¡æ¯å’Œä»¤ç‰Œ

ä»¤ç‰ŒéªŒè¯æµç¨‹:
1. å®¢æˆ·ç«¯æºå¸¦JWTä»¤ç‰Œ
2. éªŒè¯ä»¤ç‰Œæœ‰æ•ˆæ€§
3. æå–ç”¨æˆ·ä¿¡æ¯
4. è¿”å›éªŒè¯ç»“æœ
```

## ğŸ“ ç›®å½•ç»“æ„

```
service-auth/
â”œâ”€â”€ src/main/java/com/origin/auth/
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â””â”€â”€ AuthController.java              # è®¤è¯æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ AuthService.java                 # è®¤è¯æœåŠ¡æ¥å£
â”‚   â”‚   â”œâ”€â”€ SysUserService.java              # ç”¨æˆ·æœåŠ¡æ¥å£
â”‚   â”‚   â””â”€â”€ impl/
â”‚   â”‚       â”œâ”€â”€ AuthServiceImpl.java         # è®¤è¯æœåŠ¡å®ç°
â”‚   â”‚       â””â”€â”€ SysUserServiceImpl.java      # ç”¨æˆ·æœåŠ¡å®ç°
â”‚   â”œâ”€â”€ entity/
â”‚   â”‚   â””â”€â”€ SysUser.java                     # ç”¨æˆ·å®ä½“ç±»
â”‚   â”œâ”€â”€ mapper/
â”‚   â”‚   â””â”€â”€ SysUserMapper.java               # ç”¨æˆ·æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ LoginRequest.java                # ç™»å½•è¯·æ±‚DTO
â”‚   â”‚   â”œâ”€â”€ LoginResponse.java               # ç™»å½•å“åº”DTO
â”‚   â”‚   â””â”€â”€ PasswordEncryptRequest.java      # å¯†ç åŠ å¯†è¯·æ±‚DTO
â”‚   â”œâ”€â”€ util/
â”‚   â”‚   â””â”€â”€ JwtUtil.java                     # JWTå·¥å…·ç±»
â”‚   â”œâ”€â”€ interceptor/
â”‚   â”‚   â””â”€â”€ JwtInterceptor.java              # JWTæ‹¦æˆªå™¨
â”‚   â”œâ”€â”€ exception/
â”‚   â”‚   â””â”€â”€ AuthExceptionHandler.java        # è®¤è¯å¼‚å¸¸å¤„ç†
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ SecurityConfig.java              # å®‰å…¨é…ç½®
â”‚   â”‚   â””â”€â”€ AuthWebMvcConfig.java            # Webé…ç½®
â”‚   â””â”€â”€ ServiceAuthApplication.java          # å¯åŠ¨ç±»
â””â”€â”€ src/main/resources/
    â”œâ”€â”€ application.yml                      # é…ç½®æ–‡ä»¶
    â””â”€â”€ mapper/
        â””â”€â”€ SysUserMapper.xml                # MyBatisæ˜ å°„æ–‡ä»¶
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. æ§åˆ¶å™¨ (AuthController)

#### ä¸»è¦æ¥å£
```java
@RestController
@RequestMapping("/service/auth")
public class AuthController {
    
    // ç”¨æˆ·ç™»å½•
    @PostMapping("/login")
    public ResultData<LoginResponse> login(@RequestBody @Validated LoginRequest loginRequest);
    
    // ç”¨æˆ·ç™»å‡º
    @PostMapping("/logout")
    public ResultData<String> logout(HttpServletRequest request);
    
    // å¼ºåˆ¶ç™»å‡ºç”¨æˆ·
    @PostMapping("/logout/force/{userId}")
    public ResultData<String> forceLogout(@PathVariable String userId);
    
    // å¯†ç åŠ å¯†
    @PostMapping("/password/encrypt")
    public ResultData<PasswordEncryptResponse> encryptPassword(@RequestBody PasswordEncryptRequest request);
    
    // å¯†ç éªŒè¯
    @PostMapping("/password/verify")
    public ResultData<Boolean> verifyPassword(@RequestBody PasswordEncryptRequest request);
    
    // è·å–ç”¨æˆ·ä¿¡æ¯
    @GetMapping("/user/info")
    public ResultData<SysUser> getUserInfo(@RequestParam("userId") String userId);
    
    // éªŒè¯JWTä»¤ç‰Œ
    @PostMapping("/validate")
    public ResultData<Boolean> validateToken(@RequestParam("token") String token);
    
    // å¥åº·æ£€æŸ¥
    @GetMapping("/test")
    public ResultData<String> test(HttpServletRequest request);
}
```

#### æ¥å£è¯´æ˜
| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| ç”¨æˆ·ç™»å½• | POST | `/service/auth/login` | å¤„ç†ç”¨æˆ·ç™»å½•è¯·æ±‚ï¼Œè¿”å›JWTä»¤ç‰Œ |
| ç”¨æˆ·ç™»å‡º | POST | `/service/auth/logout` | å¤„ç†ç”¨æˆ·ç™»å‡ºè¯·æ±‚ï¼Œæ¸…é™¤ä¼šè¯ |
| å¼ºåˆ¶ç™»å‡º | POST | `/service/auth/logout/force/{userId}` | ç®¡ç†å‘˜å¼ºåˆ¶ç™»å‡ºæŒ‡å®šç”¨æˆ· |
| å¯†ç åŠ å¯† | POST | `/service/auth/password/encrypt` | ä¸ºå…¶ä»–æœåŠ¡æä¾›å¯†ç åŠ å¯†åŠŸèƒ½ |
| å¯†ç éªŒè¯ | POST | `/service/auth/password/verify` | ä¸ºå…¶ä»–æœåŠ¡æä¾›å¯†ç éªŒè¯åŠŸèƒ½ |
| è·å–ç”¨æˆ·ä¿¡æ¯ | GET | `/service/auth/user/info` | ä¸ºå…¶ä»–æœåŠ¡æä¾›ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢ |
| éªŒè¯JWTä»¤ç‰Œ | POST | `/service/auth/validate` | ä¸ºå…¶ä»–æœåŠ¡æä¾›JWTä»¤ç‰ŒéªŒè¯ |
| å¥åº·æ£€æŸ¥ | GET | `/service/auth/test` | æœåŠ¡å¥åº·æ£€æŸ¥æ¥å£ |

### 2. æœåŠ¡å±‚ (AuthService)

#### æ ¸å¿ƒæ–¹æ³•
```java
public interface AuthService {
    
    // ç”¨æˆ·ç™»å½•
    LoginResponse login(LoginRequest loginRequest);
    
    // ç”¨æˆ·ç™»å‡º
    void logout(String token);
    
    // å¼ºåˆ¶ç™»å‡ºç”¨æˆ·
    void forceLogout(String userId);
}
```

#### ä¸šåŠ¡é€»è¾‘
```java
// ç™»å½•ä¸šåŠ¡é€»è¾‘
public LoginResponse login(LoginRequest loginRequest) {
    // 1. éªŒè¯ç”¨æˆ·åå¯†ç 
    // 2. ç”ŸæˆJWTä»¤ç‰Œ
    // 3. è®°å½•ç™»å½•æ—¥å¿—
    // 4. è¿”å›ç”¨æˆ·ä¿¡æ¯å’Œä»¤ç‰Œ
}
```

### 3. Feignå®¢æˆ·ç«¯åˆ—è¡¨

#### ä¾èµ–çš„å¤–éƒ¨æœåŠ¡
| æœåŠ¡åç§° | Feignå®¢æˆ·ç«¯ | ä¸»è¦ç”¨é€” | æ¥å£è·¯å¾„ |
|----------|-------------|----------|----------|
| æ—  | æ—  | è®¤è¯æœåŠ¡ä¸ºå…¶ä»–æœåŠ¡æä¾›è®¤è¯åŠŸèƒ½ï¼Œä¸ä¾èµ–å¤–éƒ¨æœåŠ¡ | æ—  |

#### Feignå®¢æˆ·ç«¯æ¥å£
æœ¬æ¨¡å—ä¸åŒ…å«Feignå®¢æˆ·ç«¯ï¼Œä¸»è¦ä¸ºå…¶ä»–å¾®æœåŠ¡æä¾›è®¤è¯æœåŠ¡ã€‚

### 4. å·¥å…·ç±» (JwtUtil)

#### æ ¸å¿ƒåŠŸèƒ½
```java
@Component
public class JwtUtil {
    
    // ç”ŸæˆJWTä»¤ç‰Œ
    public String generateToken(String userId, String username);
    
    // éªŒè¯JWTä»¤ç‰Œ
    public boolean validateToken(String token);
    
    // ä»ä»¤ç‰Œä¸­æå–ç”¨æˆ·ID
    public String getUserIdFromToken(String token);
    
    // ä»ä»¤ç‰Œä¸­æå–ç”¨æˆ·å
    public String getUsernameFromToken(String token);
}
```

### 5. æ‹¦æˆªå™¨ (JwtInterceptor)

#### æ‹¦æˆªé€»è¾‘
```java
@Component
public class JwtInterceptor implements HandlerInterceptor {
    
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {
        // 1. æå–JWTä»¤ç‰Œ
        // 2. éªŒè¯ä»¤ç‰Œæœ‰æ•ˆæ€§
        // 3. è®¾ç½®ç”¨æˆ·ä¸Šä¸‹æ–‡
        // 4. è®°å½•è®¿é—®æ—¥å¿—
        
        return true;
    }
}
```

## ğŸ—„ï¸ æ•°æ®æ¨¡å‹

### å®ä½“ç±» (SysUser)
```java
@Data
@TableName("sys_user")
public class SysUser extends BaseEntity {
    
    @TableId(value = "user_id", type = IdType.ASSIGN_ID)
    private String userId;                    // ç”¨æˆ·ID
    
    private String phone;                     // æ‰‹æœºå·
    private String wechatId;                  // å¾®ä¿¡ç”¨æˆ·ID
    private String youzanId;                  // æœ‰èµç”¨æˆ·ID
    private String username;                  // ç”¨æˆ·å
    private String password;                  // å¯†ç ï¼ˆåŠ å¯†ï¼‰
    private String nickname;                  // æ˜µç§°
    private String avatar;                    // å¤´åƒURL
    private String email;                     // é‚®ç®±
    private Integer gender;                   // æ€§åˆ«ï¼š0-æœªçŸ¥ï¼Œ1-ç”·ï¼Œ2-å¥³
    private LocalDate birthday;               // ç”Ÿæ—¥
    private Integer status;                   // ç”¨æˆ·çŠ¶æ€
    private Integer userType;                 // ç”¨æˆ·ç±»å‹
    private String profileId;                 // æ‰©å±•ä¿¡æ¯ID
    private LocalDateTime lastLoginTime;      // æœ€åç™»å½•æ—¶é—´
}
```

### DTOè®¾è®¡

#### è¯·æ±‚DTO (LoginRequest)
```java
@Data
public class LoginRequest {
    private String username;                  // ç”¨æˆ·å
    private String password;                  // å¯†ç 
    private String captcha;                   // éªŒè¯ç 
    private String captchaKey;                // éªŒè¯ç é”®
    private Boolean rememberMe;               // è®°ä½æˆ‘
}
```

#### å“åº”DTO (LoginResponse)
```java
@Data
public class LoginResponse {
    private String userId;                    // ç”¨æˆ·ID
    private String username;                  // ç”¨æˆ·å
    private String nickname;                  // æ˜µç§°
    private String avatar;                    // å¤´åƒURL
    private String token;                     // JWTä»¤ç‰Œ
    private String tokenType;                 // ä»¤ç‰Œç±»å‹
    private Long expiresIn;                   // è¿‡æœŸæ—¶é—´
    private Integer userType;                 // ç”¨æˆ·ç±»å‹
    private String userTypeDesc;              // ç”¨æˆ·ç±»å‹æè¿°
}
```

## ğŸ” å®‰å…¨è®¾è®¡

### 1. è®¤è¯æˆæƒ
- **JWTéªŒè¯**: é€šè¿‡JWTæ‹¦æˆªå™¨éªŒè¯ç”¨æˆ·èº«ä»½
- **å¯†ç åŠ å¯†**: ä½¿ç”¨BCryptç®—æ³•åŠ å¯†ç”¨æˆ·å¯†ç 
- **ä»¤ç‰Œç®¡ç†**: JWTä»¤ç‰ŒåŒ…å«ç”¨æˆ·ä¿¡æ¯å’Œè¿‡æœŸæ—¶é—´
- **ä¼šè¯æ§åˆ¶**: æ”¯æŒå¼ºåˆ¶ç™»å‡ºå’Œä»¤ç‰Œé»‘åå•

### 2. æ•°æ®å®‰å…¨
- **å¯†ç å®‰å…¨**: å¯†ç ä½¿ç”¨BCryptåŠ å¯†å­˜å‚¨
- **è¾“å…¥éªŒè¯**: æ‰€æœ‰è¾“å…¥å‚æ•°è¿›è¡ŒéªŒè¯
- **SQLæ³¨å…¥é˜²æŠ¤**: ä½¿ç”¨MyBatis Pluså‚æ•°åŒ–æŸ¥è¯¢
- **æ•æ„Ÿæ•°æ®å¤„ç†**: å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯ä¸è¿”å›ç»™å‰ç«¯

### 3. æ¥å£å®‰å…¨
- **æ¥å£é™æµ**: ç™»å½•æ¥å£è¿›è¡Œé™æµä¿æŠ¤
- **å¼‚å¸¸å¤„ç†**: ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
- **æ—¥å¿—è®°å½•**: å…³é”®æ“ä½œçš„æ—¥å¿—è®°å½•
- **é“¾è·¯è¿½è¸ª**: æ”¯æŒè¯·æ±‚é“¾è·¯è¿½è¸ª

## âš™ï¸ é…ç½®ç®¡ç†

### åº”ç”¨é…ç½®
```yaml
spring:
  application:
    name: service-auth
  datasource:
    url: jdbc:mysql://localhost:3306/banyu
    username: ${MYSQL_USERNAME:root}
    password: ${MYSQL_PASSWORD:root}
  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    database: ${REDIS_DATABASE:0}

# JWTé…ç½®
jwt:
  secret: ${JWT_SECRET:your-secret-key}
  expiration: ${JWT_EXPIRATION:86400}
  header: Authorization

# å®‰å…¨é…ç½®
security:
  bcrypt:
    strength: 12
  login:
    max-attempts: 5
    lock-duration: 300
```

### ç¯å¢ƒé…ç½®
- **å¼€å‘ç¯å¢ƒ**: `application-dev.yml`
- **æµ‹è¯•ç¯å¢ƒ**: `application-test.yml`
- **ç”Ÿäº§ç¯å¢ƒ**: `application-prod.yml`

## ğŸ”„ ä¸šåŠ¡æµç¨‹

### 1. ç”¨æˆ·ç™»å½•æµç¨‹
```
1. å®¢æˆ·ç«¯å‘é€ç™»å½•è¯·æ±‚
   â†“
2. éªŒè¯ç”¨æˆ·åå’Œå¯†ç 
   â†“
3. æ£€æŸ¥ç”¨æˆ·çŠ¶æ€å’Œæƒé™
   â†“
4. ç”ŸæˆJWTä»¤ç‰Œ
   â†“
5. è®°å½•ç™»å½•æ—¥å¿—
   â†“
6. è¿”å›ç”¨æˆ·ä¿¡æ¯å’Œä»¤ç‰Œ
```

### 2. ä»¤ç‰ŒéªŒè¯æµç¨‹
```
1. å®¢æˆ·ç«¯æºå¸¦JWTä»¤ç‰Œ
   â†“
2. æ‹¦æˆªå™¨æå–ä»¤ç‰Œ
   â†“
3. éªŒè¯ä»¤ç‰Œç­¾åå’Œè¿‡æœŸæ—¶é—´
   â†“
4. æ£€æŸ¥ä»¤ç‰Œæ˜¯å¦åœ¨é»‘åå•
   â†“
5. æå–ç”¨æˆ·ä¿¡æ¯
   â†“
6. è®¾ç½®ç”¨æˆ·ä¸Šä¸‹æ–‡
```

### 3. ç”¨æˆ·ç™»å‡ºæµç¨‹
```
1. å®¢æˆ·ç«¯å‘é€ç™»å‡ºè¯·æ±‚
   â†“
2. éªŒè¯JWTä»¤ç‰Œ
   â†“
3. å°†ä»¤ç‰ŒåŠ å…¥é»‘åå•
   â†“
4. æ¸…é™¤ç”¨æˆ·ä¼šè¯
   â†“
5. è®°å½•ç™»å‡ºæ—¥å¿—
   â†“
6. è¿”å›ç™»å‡ºæˆåŠŸå“åº”
```

## ğŸš¨ å¼‚å¸¸å¤„ç†ä¸é”™è¯¯ç 

### 1. å¼‚å¸¸å¤„ç†æœºåˆ¶
- **ç»Ÿä¸€å¼‚å¸¸å¤„ç†**: ä½¿ç”¨`@ControllerAdvice`ç»Ÿä¸€å¤„ç†å¼‚å¸¸
- **ä¸šåŠ¡å¼‚å¸¸**: ä½¿ç”¨`BusinessException`å¤„ç†ä¸šåŠ¡é€»è¾‘å¼‚å¸¸
- **ç³»ç»Ÿå¼‚å¸¸**: ä½¿ç”¨`GlobalExceptionHandler`å¤„ç†ç³»ç»Ÿå¼‚å¸¸
- **å‚æ•°éªŒè¯**: ä½¿ç”¨`@Valid`å’Œ`@Validated`è¿›è¡Œå‚æ•°éªŒè¯

### 2. é”™è¯¯ç å®šä¹‰

#### åŸºç¡€é”™è¯¯ç 
| é”™è¯¯ç  | é”™è¯¯ç±»å‹ | é”™è¯¯æè¿° |
|--------|----------|----------|
| 400 | å‚æ•°é”™è¯¯ | è¯·æ±‚å‚æ•°ä¸æ­£ç¡® |
| 401 | æœªæˆæƒ | ç”¨æˆ·æœªç™»å½•æˆ–è®¤è¯å¤±è´¥ |
| 403 | ç¦æ­¢è®¿é—® | ç”¨æˆ·æƒé™ä¸è¶³ |
| 404 | èµ„æºä¸å­˜åœ¨ | è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨ |
| 500 | ç³»ç»Ÿé”™è¯¯ | ç³»ç»Ÿå†…éƒ¨é”™è¯¯ |

#### è®¤è¯æ¨¡å—ç‰¹æ®Šé”™è¯¯ç 
| é”™è¯¯ç  | é”™è¯¯ç±»å‹ | é”™è¯¯æè¿° |
|--------|----------|----------|
| 1101 | è®¤è¯å¤±è´¥ | è®¤è¯è¿‡ç¨‹å¤±è´¥ |
| 1102 | è®¤è¯ä»¤ç‰Œç¼ºå¤± | æœªæä¾›è®¤è¯ä»¤ç‰Œ |
| 1103 | è®¤è¯ä»¤ç‰Œå·²è¿‡æœŸ | è®¤è¯ä»¤ç‰Œå·²è¿‡æœŸ |
| 1104 | è®¤è¯ä»¤ç‰Œæ— æ•ˆ | è®¤è¯ä»¤ç‰Œæ ¼å¼æˆ–ç­¾åæ— æ•ˆ |
| 1105 | ç”¨æˆ·è´¦å·å·²è¢«ç¦ç”¨ | ç”¨æˆ·è´¦å·è¢«ç¦ç”¨æˆ–å¾…å®¡æ ¸ |
| 1106 | ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ | ç™»å½•å‡­æ®é”™è¯¯ |

#### ç”¨æˆ·æ¨¡å—ç›¸å…³é”™è¯¯ç 
| é”™è¯¯ç  | é”™è¯¯ç±»å‹ | é”™è¯¯æè¿° |
|--------|----------|----------|
| 1001 | ç”¨æˆ·ä¸å­˜åœ¨ | æŒ‡å®šçš„ç”¨æˆ·ä¸å­˜åœ¨ |
| 1002 | ç”¨æˆ·å·²å­˜åœ¨ | ç”¨æˆ·åæˆ–æ‰‹æœºå·å·²å­˜åœ¨ |
| 1003 | å¯†ç é”™è¯¯ | ç”¨æˆ·å¯†ç é”™è¯¯ |
| 1004 | è´¦å·å·²è¢«ç¦ç”¨ | ç”¨æˆ·è´¦å·å·²è¢«ç¦ç”¨ |
| 1005 | ä»¤ç‰Œå·²è¿‡æœŸ | JWTä»¤ç‰Œå·²è¿‡æœŸ |
| 1006 | ä»¤ç‰Œæ— æ•ˆ | JWTä»¤ç‰Œæ— æ•ˆ |
| 1007 | ç”¨æˆ·æ¡£æ¡ˆä¸å­˜åœ¨ | ç”¨æˆ·æ¡£æ¡ˆä¿¡æ¯ä¸å­˜åœ¨ |
| 1008 | ç”¨æˆ·å¤´åƒä¸Šä¼ å¤±è´¥ | ç”¨æˆ·å¤´åƒä¸Šä¼ æ“ä½œå¤±è´¥ |
| 1009 | ç”¨æˆ·æƒé™ä¸è¶³ | ç”¨æˆ·æƒé™ä¸è¶³ä»¥æ‰§è¡Œæ“ä½œ |

### 3. å¼‚å¸¸å¤„ç†æµç¨‹
```
1. å¼‚å¸¸å‘ç”Ÿ
   â†“
2. å¼‚å¸¸æ‹¦æˆªå™¨æ•è·
   â†“
3. å¼‚å¸¸åˆ†ç±»å¤„ç†
   â†“
4. é”™è¯¯ç æ˜ å°„
   â†“
5. é”™è¯¯ä¿¡æ¯æ ¼å¼åŒ–
   â†“
6. è¿”å›ç»Ÿä¸€é”™è¯¯å“åº”
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. ç¼“å­˜ç­–ç•¥
- **Redisç¼“å­˜**: ç”¨æˆ·ä¿¡æ¯ç¼“å­˜ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢
- **ä»¤ç‰Œç¼“å­˜**: JWTä»¤ç‰ŒéªŒè¯ç»“æœç¼“å­˜
- **é»‘åå•ç¼“å­˜**: ç™»å‡ºä»¤ç‰Œé»‘åå•ç¼“å­˜
- **ç¼“å­˜è¿‡æœŸ**: åˆç†çš„ç¼“å­˜è¿‡æœŸæ—¶é—´è®¾ç½®

### 2. æ•°æ®åº“ä¼˜åŒ–
- **ç´¢å¼•ä¼˜åŒ–**: ç”¨æˆ·åã€é‚®ç®±ç­‰å­—æ®µåˆ›å»ºç´¢å¼•
- **æŸ¥è¯¢ä¼˜åŒ–**: ä½¿ç”¨MyBatis Plusä¼˜åŒ–æŸ¥è¯¢
- **è¿æ¥æ± **: é…ç½®åˆé€‚çš„æ•°æ®åº“è¿æ¥æ± 
- **åˆ†é¡µæŸ¥è¯¢**: ç”¨æˆ·åˆ—è¡¨ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢

### 3. æ¥å£ä¼˜åŒ–
- **å¼‚æ­¥å¤„ç†**: æ—¥å¿—è®°å½•ä½¿ç”¨å¼‚æ­¥å¤„ç†
- **æ‰¹é‡æ“ä½œ**: æ‰¹é‡å¤„ç†ç”¨æˆ·æ“ä½œ
- **é™æµä¿æŠ¤**: ç™»å½•æ¥å£é™æµä¿æŠ¤
- **å“åº”ä¼˜åŒ–**: åˆç†è®¾ç½®å“åº”æ•°æ®å¤§å°

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•
- **Serviceå±‚æµ‹è¯•**: æµ‹è¯•è®¤è¯ä¸šåŠ¡é€»è¾‘
- **Utilå±‚æµ‹è¯•**: æµ‹è¯•JWTå·¥å…·ç±»åŠŸèƒ½
- **Mapperå±‚æµ‹è¯•**: æµ‹è¯•æ•°æ®è®¿é—®å±‚

### 2. é›†æˆæµ‹è¯•
- **APIæµ‹è¯•**: æµ‹è¯•RESTæ¥å£åŠŸèƒ½
- **æ•°æ®åº“æµ‹è¯•**: æµ‹è¯•æ•°æ®åº“æ“ä½œ
- **ç¼“å­˜æµ‹è¯•**: æµ‹è¯•Redisç¼“å­˜åŠŸèƒ½

### 3. æ€§èƒ½æµ‹è¯•
- **å¹¶å‘æµ‹è¯•**: æµ‹è¯•å¹¶å‘ç™»å½•æ€§èƒ½
- **å‹åŠ›æµ‹è¯•**: æµ‹è¯•ç³»ç»Ÿæ‰¿è½½èƒ½åŠ›
- **ç¨³å®šæ€§æµ‹è¯•**: æµ‹è¯•é•¿æœŸè¿è¡Œç¨³å®šæ€§

### Mocké…ç½®
```java
@TestConfiguration
public class TestConfig implements WebMvcConfigurer {
    
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        // åœ¨æµ‹è¯•ç¯å¢ƒä¸­æ’é™¤æ‰€æœ‰éœ€è¦è®¤è¯çš„è·¯å¾„
        // è¿™æ ·å¯ä»¥ä¸“æ³¨äºæµ‹è¯•ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸éœ€è¦å¤„ç†è®¤è¯
    }
}

@TestConfiguration
@EnableWebSecurity
@Profile("test")
public class TestSecurityConfig {
    
    @Bean
    public SecurityFilterChain testSecurityFilterChain(HttpSecurity http) throws Exception {
        http
            .csrf(AbstractHttpConfigurer::disable)
            .sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
            .authorizeHttpRequests(authz -> authz.anyRequest().permitAll());
        return http.build();
    }
}
```

## ğŸ“ˆ ç›‘æ§æŒ‡æ ‡

### 1. ä¸šåŠ¡æŒ‡æ ‡
- **ç™»å½•æˆåŠŸç‡**: ç™»å½•æˆåŠŸæ¬¡æ•°/æ€»ç™»å½•æ¬¡æ•°
- **ç™»å½•å“åº”æ—¶é—´**: ç™»å½•æ¥å£å¹³å‡å“åº”æ—¶é—´
- **æ´»è·ƒç”¨æˆ·æ•°**: å½“å‰åœ¨çº¿ç”¨æˆ·æ•°é‡
- **ä»¤ç‰ŒéªŒè¯é¢‘ç‡**: JWTä»¤ç‰ŒéªŒè¯æ¬¡æ•°

### 2. æŠ€æœ¯æŒ‡æ ‡
- **æ¥å£å“åº”æ—¶é—´**: å„æ¥å£å¹³å‡å“åº”æ—¶é—´
- **é”™è¯¯ç‡**: æ¥å£é”™è¯¯ç‡ç»Ÿè®¡
- **ç¼“å­˜å‘½ä¸­ç‡**: Redisç¼“å­˜å‘½ä¸­ç‡
- **æ•°æ®åº“è¿æ¥æ•°**: æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨æƒ…å†µ

### 3. å®‰å…¨æŒ‡æ ‡
- **ç™»å½•å¤±è´¥æ¬¡æ•°**: ç™»å½•å¤±è´¥ç»Ÿè®¡
- **å¼‚å¸¸è®¿é—®æ¬¡æ•°**: å¼‚å¸¸è®¿é—®ç»Ÿè®¡
- **ä»¤ç‰Œè¿‡æœŸæ¬¡æ•°**: JWTä»¤ç‰Œè¿‡æœŸç»Ÿè®¡
- **å¼ºåˆ¶ç™»å‡ºæ¬¡æ•°**: å¼ºåˆ¶ç™»å‡ºæ“ä½œç»Ÿè®¡

## ğŸ”® æ‰©å±•è§„åˆ’

### 1. åŠŸèƒ½æ‰©å±•
- **å¤šå› å­è®¤è¯**: æ”¯æŒçŸ­ä¿¡ã€é‚®ç®±éªŒè¯ç è®¤è¯
- **OAuth2é›†æˆ**: æ”¯æŒç¬¬ä¸‰æ–¹ç™»å½•
- **æƒé™ç®¡ç†**: ç»†ç²’åº¦æƒé™æ§åˆ¶
- **å®¡è®¡æ—¥å¿—**: å®Œæ•´çš„æ“ä½œå®¡è®¡æ—¥å¿—

### 2. æ€§èƒ½ä¼˜åŒ–
- **åˆ†å¸ƒå¼ç¼“å­˜**: ä½¿ç”¨Redisé›†ç¾¤
- **æ•°æ®åº“åˆ†åº“åˆ†è¡¨**: æ”¯æŒå¤§è§„æ¨¡ç”¨æˆ·
- **å¾®æœåŠ¡æ‹†åˆ†**: è¿›ä¸€æ­¥æ‹†åˆ†è®¤è¯æœåŠ¡
- **CDNåŠ é€Ÿ**: é™æ€èµ„æºCDNåŠ é€Ÿ

### 3. æ¶æ„å‡çº§
- **æœåŠ¡ç½‘æ ¼**: é›†æˆIstioæœåŠ¡ç½‘æ ¼
- **å®¹å™¨åŒ–éƒ¨ç½²**: æ”¯æŒKuberneteséƒ¨ç½²
- **ç›‘æ§å‘Šè­¦**: å®Œå–„ç›‘æ§å‘Šè­¦ä½“ç³»
- **è‡ªåŠ¨åŒ–è¿ç»´**: å®ç°è‡ªåŠ¨åŒ–è¿ç»´

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2025-07-31  
**ç»´æŠ¤äººå‘˜**: scccy 