# 半语积分商城

## 项目介绍

### 项目概述
半语积分商城是一个基于微服务架构的积分任务平台，支持B端发布任务、C端完成任务获得积分，并将积分同步到有赞商城，形成完整的商业闭环。

### 核心业务逻辑
- **B端（发布者）**：发布六种任务（点赞、评论、话题讨论、社群分享、邀请好友、反馈），查看排行榜，审核社群分享任务
- **C端（接收者）**：在企业微信小程序接收任务，完成任务获得积分，查看任务详情和排行榜
- **积分系统**：任务完成 → 积分发放 → 有赞同步 → 商城消费 → 积分扣减

### 任务类型
| 任务类型 | 描述 | 审核要求 | 积分奖励 |
|---------|------|----------|----------|
| 点赞 | 对指定内容进行点赞 | 无需审核 | 根据难度设定 |
| 评论 | 对指定内容进行评论 | 无需审核 | 根据难度设定 |
| 话题讨论 | 参与指定话题讨论 | 无需审核 | 根据难度设定 |
| 社群分享 | 在社群中分享指定内容 | 需要B端审核 | 根据难度设定 |
| 邀请好友 | 邀请新用户注册 | 无需审核 | 固定奖励 |
| 反馈 | 提供产品使用反馈 | 无需审核 | 根据质量设定 |

### 原型图
- B端原型图：`proto/b/` 目录
- C端原型图：`proto/c/` 目录

## 技术架构

### 技术栈
- **核心框架**: Spring Boot 3.x, Spring Cloud 2023.x
- **开发语言**: Java 21
- **安全认证**: JWT + Redis
- **服务注册发现**: Nacos 2.x
- **配置中心**: Nacos 2.x
- **对象存储**: 阿里云OSS
- **数据库**: MySQL 8.0+, Redis 7.x
- **API文档**: Swagger 3.x / OpenAPI 3.x
- **消息队列**: Kafka (可选，用于任务异步处理)

### 微服务架构
```
半语积分商城
├── 核心服务层 (service-*)
│   ├── service-base      [✓ 已完成] 全局基础支撑
│   ├── service-auth      [✓ 已完成] 认证授权服务
│   ├── service-user      [✓ 已完成] 用户管理服务
│   ├── service-gateway   [✓ 已完成] API网关服务
│   ├── service-task      [ ] 任务管理服务
│   ├── service-points    [ ] 积分管理服务
│   ├── service-file      [ ] 文件管理服务
│   └── service-sync      [ ] 第三方同步服务
├── 第三方集成层 (integration-*)
│   ├── integration-wechat [ ] 微信生态集成
│   └── integration-youzan [ ] 有赞API集成
├── 业务模块 (biz-*)
│   ├── biz-task          [ ] 发布者任务管理
│   └── biz-order         [ ] 接单人订单流程
└── 基础设施 (infra-*)
    ├── infra-registry    [ ] 服务注册发现
    ├── infra-monitor     [ ] 监控服务
    └── infra-log         [ ] 日志服务
```

## 服务模块详情

### 1. 核心服务层（service-*）

#### service-base [✓ 已完成]
全局基础支撑模块
- [x] 配置类：MyBatis-Plus分页/事务/WebMvc配置
- [x] 工具类：日期/加密/校验/JSON转换
- [x] 公共DTO：请求/响应模型、分页对象
- [x] OpenFeign集成：服务间API调用封装

#### service-auth [ ]
认证授权服务
- [ ] Web端登录（账号密码+验证码）
- [ ] 微信小程序登录（UnionID绑定）
- [ ] JWT令牌生成/校验（Redis黑名单管理）

#### service-user [✓ 已完成]
用户管理服务
- [x] 角色权限：发布者/接单人角色定义
- [x] 用户信息CRUD（含敏感信息加密）
- [x] 权限控制：基于RBAC的接口鉴权
- [x] 用户扩展信息管理
- [x] 用户配置管理

#### service-task [ ]
任务管理服务
- [ ] 任务发布：富文本描述+奖励设置
- [ ] 状态管理：草稿→待审核→已发布→验收→完成
- [ ] 任务搜索：按类型/奖励/状态筛选

#### service-points [ ]
积分管理服务
- [ ] 积分发放：任务完成后的积分计算和发放
- [ ] 积分消费：有赞商城消费后的积分扣减
- [ ] 积分流水：完整的积分变动记录

#### service-file [ ]
文件管理服务
- [ ] 阿里云OSS上传/下载（任务附件管理）
- [ ] 文件权限：仅任务相关用户访问
- [ ] 图片处理：压缩/格式转换

#### service-sync [ ]
第三方同步服务
- [ ] 有赞订单同步
- [ ] 微信用户信息同步
- [ ] 数据一致性保证

### 2. 第三方集成层（integration-*）

#### integration-wechat [ ]
微信生态集成
- [ ] 小程序登录接口封装
- [ ] 消息推送（模板消息/订阅消息）
- [ ] 朋友圈API集成

#### integration-youzan [ ]
有赞API集成
- [ ] 订单同步接口
- [ ] 商品信息拉取
- [ ] 积分兑换接口

### 3. 业务模块（biz-*）

#### biz-task [ ]
发布者任务管理
- [ ] 任务发布：富文本描述+奖励设置
- [ ] 状态管理：草稿→待审核→已发布→验收→完成
- [ ] 任务搜索：按类型/奖励/状态筛选

#### biz-order [ ]
接单人订单流程
- [ ] 接单流程：任务申请→资格校验→生成订单
- [ ] 成果交付：多文件上传+提交验收
- [ ] 订单结算：验收通过后奖励发放

### 4. 基础设施（infra-*）

#### infra-gateway [ ]
API网关
- [ ] 路由转发：按服务名动态路由
- [ ] 统一认证：JWT前置校验（白名单配置）
- [ ] 限流熔断：基于IP/用户的流量控制

#### infra-registry [ ]
服务注册发现（Nacos）
- [ ] 实例管理：自动注册+健康检查
- [ ] 负载均衡：权重策略配置

#### infra-monitor [ ]
监控服务
- [ ] 应用性能监控
- [ ] 业务指标监控
- [ ] 告警通知

#### infra-log [ ]
日志服务
- [ ] 日志收集
- [ ] 日志分析
- [ ] 链路追踪

## 开发规范

### 文档驱动开发
本项目采用文档驱动开发框架，所有开发工作都基于 `.docs` 目录下的文档进行：

- **STATE/**: 事实基线文档（项目概述、技术栈、架构设计等）
- **PROCESS/**: 过程流水文档（任务模板、提案模板等）
- **RULES/**: 开发规则文档（编码规范、使用规范等）
- **TEMP/**: 临时状态文件（任务执行状态跟踪）

### 开发流程
1. 查阅相关规则文档（`.docs/RULES/`）
2. 创建任务状态文件（`.docs/TEMP/`）
3. 按照计划执行开发任务
4. 更新基线文档（`.docs/STATE/`）
5. 沉淀经验规则（`.docs/RULES/`）

### 技术规范
- **编码规范**: 遵循 `.docs/RULES/DEV-001.md`
- **OSS使用规范**: 遵循 `.docs/RULES/OSS-001.md`
- **项目初始化规范**: 遵循 `.docs/RULES/INIT-001.md`
- **API文档维护规范**: 遵循 `.docs/RULES/API-DOC-001.md`

## API 文档

### 接口文档
详细的API接口文档请参考：[API.md](./API.md)

该文档包含：
- 所有微服务的接口信息
- 请求参数和响应格式
- 服务路由配置
- 错误码说明
- 接口调用示例
- 开发环境配置

### 接口规范
- **认证方式**: Bearer Token (JWT)
- **响应格式**: 统一使用 `ResultData<T>` 格式
- **字符编码**: UTF-8
- **Content-Type**: application/json

## 快速开始

### 环境要求
- JDK 21+
- Maven 3.8+
- MySQL 8.0+
- Redis 7.x
- Nacos 2.x

### 本地开发
```bash
# 1. 克隆项目
git clone [项目地址]
cd banyuMall

# 2. 配置环境变量
export OSS_ACCESS_KEY_ID='YOUR_ACCESS_KEY_ID'
export OSS_ACCESS_KEY_SECRET='YOUR_ACCESS_KEY_SECRET'

# 3. 启动依赖服务
# MySQL, Redis, Nacos

# 4. 启动服务
mvn spring-boot:run -pl service/service-system
```

### 配置说明
详细配置请参考：
- 技术栈配置：`.docs/STATE/TECH-STACK.md`
- OSS集成配置：`.docs/STATE/OSS-INTEGRATION.md`
- 项目概述：`.docs/STATE/PROJECT-OVERVIEW.md`
- 基础设施文档：`infra/docs/` 目录
- 任务完成索引：`TASK-INDEX.md`

## 部署说明

### 开发环境
- 操作系统：macOS / Windows / Linux
- 容器：Docker Desktop
- 数据库：Docker容器化部署

### 生产环境
- 操作系统：Linux (CentOS 7+ / Ubuntu 18+)
- 容器：Docker + Kubernetes
- 数据库：独立服务器部署
- 负载均衡：Nginx / HAProxy

## 性能要求
- 任务列表响应时间 < 2秒
- 积分同步延迟 < 5秒
- 文件上传支持并发
- 系统可用性 > 99.9%

## 安全考虑
- JWT令牌认证
- 敏感信息加密存储
- 任务防刷机制
- 积分防刷机制
- 文件访问权限控制
- OSS访问权限控制

## 贡献指南

### 开发流程
1. 创建功能分支
2. 查阅相关规则文档
3. 创建任务状态文件
4. 按照规范进行开发
5. 提交代码并创建PR
6. 代码审查通过后合并

### 文档维护
- 所有重要决策必须更新相关基线文档
- 新的开发经验必须沉淀为规则文档
- 任务完成后必须更新状态文件

## 联系方式
- 项目维护者：[维护者信息]
- 技术支持：[技术支持信息]
- 问题反馈：[问题反馈渠道]

## 许可证
[许可证信息]